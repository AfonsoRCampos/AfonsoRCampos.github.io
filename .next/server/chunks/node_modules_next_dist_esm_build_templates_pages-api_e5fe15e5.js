module.exports=[49882,e=>{"use strict";e.s(["config",()=>g,"default",()=>f,"handler",()=>S],49882);var t=e.i(26747),r=e.i(90406),i=e.i(44898),a=e.i(62950);e.s(["default",()=>u],30710);var n=e.i(22734),s=e.i(14747);function c(e){var t;if(!e)return"";let[r,i]=e.trim().split(" ");return r&&i?`${r.charAt(0).toUpperCase()}. ${(t=i).charAt(0).toUpperCase()+t.slice(1).toLowerCase()}`:e}function l(e){if(!e)return"N/A";try{let t=new Date(e);if(isNaN(t))return String(e);let r=e=>String(e).padStart(2,"0"),i=r(t.getUTCDate()),a=r(t.getUTCMonth()+1),n=t.getUTCFullYear(),s=r(t.getUTCHours()),c=r(t.getUTCMinutes());if(0===t.getUTCHours()&&0===t.getUTCMinutes()&&0===t.getUTCSeconds())return`${i}-${a}-${n}`;return`${i}-${a}-${n} ${s}:${c}`}catch(t){return String(e)}}function o(e,t){let r=Array.isArray(e)?e:e?[e]:[],i=Array.isArray(t)?t:t?[t]:[];if(r.length!==i.length)return!1;let a=e=>e.map(e=>"object"==typeof e?JSON.stringify(e):String(e)).sort(),n=a(r),s=a(i);for(let e=0;e<n.length;e++)if(n[e]!==s[e])return!1;return!0}function d(e){if(!e)return 0;let t=e.toUpperCase().split(""),r=0;for(let e=0;e<t.length;e++)r=26*r+(t[e].charCodeAt(0)-64);return r}function u(e,t){let{series:r}=e.query;if(!r)return t.status(400).json({error:"Missing series id"});let i=s.default.join(process.cwd(),"src","data","A3Versions.json"),a={};if(n.default.existsSync(i))try{a=JSON.parse(n.default.readFileSync(i,"utf8")||"{}")}catch(e){a={}}if("GET"===e.method){let e=a[r]||{versions:{},history:[],currentVersion:null};return t.status(200).json(e)}if("POST"===e.method){let e=s.default.join(process.cwd(),"src","data","A3s.json");if(!n.default.existsSync(e))return t.status(500).json({error:"A3s data missing"});let u=JSON.parse(n.default.readFileSync(e,"utf8")||"[]"),h=u.find(e=>e.header&&e.header.id&&e.header.id.split("-")[1]===r);if(!h)return t.status(404).json({error:"Series not found"});a[r]=a[r]||{};let p=Object.keys(a[r]||{}),m=0===p.length?null:p.sort((e,t)=>d(e)-d(t))[p.length-1],f=m?function(e){if(!e)return"A";let t=e.toUpperCase().split("").map(e=>e.charCodeAt(0)-65);for(let e=t.length-1;e>=0;e--){if(t[e]+=1,t[e]<26)return t.map(e=>String.fromCharCode(65+e)).join("");if(t[e]=0,0===e)return(t=[0].concat(t)).map(e=>String.fromCharCode(65+e)).join("")}return"A"}(m):"B",{changelog:g}=function(e,t){if(!t)return{changelog:{General:["Initial snapshot."]}};try{let r={};for(let i of["General","Problem Definition","Metrics & Objectives","Actions","Current State","Future State"])if("General"===i){if(e.header.title!==t.header.title&&(r.General=r.General||[],r.General.push(`Title changed from "${t.header.title||"Untitled"}" to "${e.header.title||"Untitled"}".`)),e.header.team!==t.header.team){let i=Array.isArray(e.header.team)?e.header.team:[],a=Array.isArray(t.header.team)?t.header.team:[],n=e=>null==e?"":"object"==typeof e?e.id||e.name||JSON.stringify(e):String(e),s=i.map(n),l=a.map(n),o=s.filter(e=>!l.includes(e)).map(e=>c(e)),d=l.filter(e=>!s.includes(e)).map(e=>c(e));o.length&&(r.General=r.General||[],r.General.push(`Team members added: ${o.join(", ")}.`)),d.length&&(r.General=r.General||[],r.General.push(`Team members removed: ${d.join(", ")}.`))}(e.header.start!==t.header.start||e.header.end!==t.header.end)&&(r.General=r.General||[],r.General.push(`Project timeline changed from ${l(t.header.start)} - ${l(t.header.end)} to ${l(e.header.start)} - ${l(e.header.end)}.`)),(e.header.refs||[]).sort().join(",")!==(t.header.refs||[]).sort().join(",")&&(r.General=r.General||[],r.General.push("External A3 references changed.")),(e.header.attachments||[]).sort().join(",")!==(t.header.attachments||[]).sort().join(",")&&(r.General=r.General||[],r.General.push("File attachments changed.")),JSON.stringify(e.layout.sections)!==JSON.stringify(t.layout.sections)&&(r.General=r.General||[],r.General.push("Layout changed.")),o(e.layout.canEdit,t.layout.canEdit)||(r.General=r.General||[],r.General.push("(OWNER) Layout edit permissions changed."))}else if("Problem Definition"===i)e.probDef.why!==t.probDef.why&&(r["Problem Definition"]=r["Problem Definition"]||[],r["Problem Definition"].push('"Why" statement updated.')),e.probDef.where!==t.probDef.where&&(r["Problem Definition"]=r["Problem Definition"]||[],r["Problem Definition"].push('"Where" statement updated.')),e.probDef.extra!==t.probDef.extra&&(r["Problem Definition"]=r["Problem Definition"]||[],r["Problem Definition"].push("Additional problem details updated.")),JSON.stringify(e.metrics.lag.placeholder)!==JSON.stringify(t.metrics.lag.placeholder)&&(r["Problem Definition"]=r["Problem Definition"]||[],r["Problem Definition"].push("Problem placeholder updated.")),o(e.probDef.canEdit,t.probDef.canEdit)||(r["Problem Definition"]=r["Problem Definition"]||[],r["Problem Definition"].push("(OWNER) Problem Definition edit permissions changed."));else if("Current State"===i)JSON.stringify(e.currentState)!==JSON.stringify(t.currentState)&&(r["Current State"]=r["Current State"]||[],r["Current State"].push("Current State canvas updated.")),e.layout.extraCurrentState.enabled!==t.layout.extraCurrentState.enabled&&(r["Current State"]=r["Current State"]||[],r["Current State"].push(`Current State comment section ${e.layout.extraCurrentState.enabled?"enabled":"disabled"}.`)),JSON.stringify(e.layout.extraCurrentState.text)!==JSON.stringify(t.layout.extraCurrentState.text)&&(r["Current State"]=r["Current State"]||[],r["Current State"].push("Current State comments updated.")),o(e.currentState.canEdit,t.currentState.canEdit)||(r["Current State"]=r["Current State"]||[],r["Current State"].push("(OWNER) Current State edit permissions changed."));else if("Future State"===i)e.layout.includeFutureState!==t.layout.includeFutureState&&(r["Future State"]=r["Future State"]||[],r["Future State"].push(`Section ${e.layout.includeFutureState?"enabled":"disabled"}.`)),JSON.stringify(e.actionPlan)!==JSON.stringify(t.actionPlan)&&(r["Future State"]=r["Future State"]||[],r["Future State"].push("Future State canvas updated.")),o(e.actionPlan.canEdit,t.actionPlan.canEdit)||(r["Future State"]=r["Future State"]||[],r["Future State"].push("(OWNER) Future State edit permissions changed."));else if("Actions"===i){let i=Array.isArray(e.actions)?e.actions:[],a=Array.isArray(t.actions)?t.actions:[],n=new Map(i.map(e=>[String(e.id),e])),s=new Map(a.map(e=>[String(e.id),e])),l=i.filter(e=>!s.has(String(e.id))),o=a.filter(e=>!n.has(String(e.id)));for(let e of(l.length&&(r.Actions=r.Actions||[],r.Actions.push(`Added actions: ${l.map(e=>`#${e.id} ${e.description||""}`.trim()).join(", ")}.`)),o.length&&(r.Actions=r.Actions||[],r.Actions.push(`Removed actions: ${o.map(e=>`#${e.id} ${e.description||""}`.trim()).join(", ")}.`)),Array.from(n.keys()).filter(e=>s.has(e)))){let t=n.get(e),i=s.get(e),a=[];if((void 0!==t.progress||void 0!==i.progress)&&t.progress!==i.progress){let e=e=>null==e?"—":1>=Number(e)?`${Math.round(100*Number(e))}%`:`${Math.round(Number(e))}%`;a.push(`progress ${e(i.progress)} → ${e(t.progress)}`)}if((t.owner||"")!==(i.owner||"")){let e=i.owner?c(i.owner):"—",r=t.owner?c(t.owner):"—";a.push(`owner ${e} → ${r}`)}if((t.limit||"")!==(i.limit||"")){let e=i.limit||"—",r=t.limit||"—";a.push(`limit ${e} → ${r}`)}if((t.weight||"")!==(i.weight||"")){let e=i.weight||"—",r=t.weight||"—";a.push(`weight ${e} → ${r}`)}a.length&&(r.Actions=r.Actions||[],r.Actions.push(`Action #${e} (${t.description||""}): ${a.join("; ")}.`))}try{let i=e.actionsSettings&&void 0!==e.actionsSettings.weighted?!!e.actionsSettings.weighted:null,a=t.actionsSettings&&void 0!==t.actionsSettings.weighted?!!t.actionsSettings.weighted:null;null!==i&&null!==a&&i!==a&&(r.Actions=r.Actions||[],r.Actions.push(`Weighting ${i?"enabled":"disabled"}.`))}catch(e){}}else if("Metrics & Objectives"===i){let i=e.metrics||{},a=t.metrics||{},n=i.lag||{},s=a.lag||{},c=n.metricName||s.metricName||"lag";(n.metricName||"")!==(s.metricName||"")&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Metric name changed: "${s.metricName||"—"}" → "${n.metricName||"—"}".`)),(n.unit||"")!==(s.unit||"")&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Metric ${c} unit changed: "${s.unit||"—"}" → "${n.unit||"—"}".`)),(void 0!==n.initial||void 0!==s.initial)&&String(n.initial||"")!==String(s.initial||"")&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Metric ${c} initial value changed: "${s.initial||"—"}" → "${n.initial||"—"}".`));let l=n.target||{},d=s.target||{},u=[];(void 0!==l.value||void 0!==d.value)&&String(l.value||"")!==String(d.value||"")&&u.push(`value ${d.value||"—"} → ${l.value||"—"}`),(void 0!==l.mode||void 0!==d.mode)&&(l.mode||"")!==(d.mode||"")&&u.push(`mode ${d.mode||"—"} → ${l.mode||"—"}`),(void 0!==l.percent||void 0!==d.percent)&&String(l.percent||"")!==String(d.percent||"")&&u.push(`percent ${d.percent||"—"} → ${l.percent||"—"}`),u.length&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Metric ${c} target changed: ${u.join("; ")}.`));try{let e=Array.isArray(n.data)?n.data:[],t=Array.isArray(s.data)?s.data:[];JSON.stringify(e)!==JSON.stringify(t)&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Metric ${c} data updated.`))}catch(e){}let h=Array.isArray(i.leads)?i.leads:[],p=Array.isArray(a.leads)?a.leads:[],m=new Map(p.map(e=>[e.metricName||String(Math.random()),e])),f=new Map(h.map(e=>[e.metricName||String(Math.random()),e])),g=h.filter(e=>!m.has(e.metricName)),y=p.filter(e=>!f.has(e.metricName));for(let[e,t]of(g.length&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Added metrics: ${g.map(e=>`${e.metricName||"unnamed"}`).join(", ")}.`)),y.length&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Removed metrics: ${y.map(e=>`${e.metricName||"unnamed"}`).join(", ")}.`)),f.entries())){if(!m.has(e))continue;let i=m.get(e),a=[];(t.unit||"")!==(i.unit||"")&&a.push(`unit ${i.unit||"—"} → ${t.unit||"—"}`),String(t.initial||"")!==String(i.initial||"")&&a.push(`initial ${i.initial||"—"} → ${t.initial||"—"}`);let n=t.target||{},s=i.target||{};String(n.value||"")!==String(s.value||"")&&a.push(`target value ${s.value||"—"} → ${n.value||"—"}`),(n.mode||"")!==(s.mode||"")&&a.push(`target mode ${s.mode||"—"} → ${n.mode||"—"}`),a.length&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Metric ${e}: ${a.join("; ")}.`));try{let a=Array.isArray(t.data)?t.data:[],n=Array.isArray(i.data)?i.data:[];JSON.stringify(a)!==JSON.stringify(n)&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Metric ${e} data updated.`))}catch(e){}}try{let e=Array.isArray(i.canEditObjectives)?i.canEditObjectives:i.canEditObjectives||[],t=Array.isArray(a.canEditObjectives)?a.canEditObjectives:a.canEditObjectives||[];JSON.stringify(e)!==JSON.stringify(t)&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push("(OWNER) Objectives edit permissions changed."));let n=Array.isArray(i.canEditMetrics)?i.canEditMetrics:i.canEditMetrics||[],s=Array.isArray(a.canEditMetrics)?a.canEditMetrics:a.canEditMetrics||[];JSON.stringify(n)!==JSON.stringify(s)&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push("(OWNER) Check Act edit permissions changed."))}catch(e){}try{e.layout&&t.layout&&e.layout.extraCheckAct&&t.layout.extraCheckAct&&(e.layout.extraCheckAct.enabled!==t.layout.extraCheckAct.enabled&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push(`Check/Act comment section ${e.layout.extraCheckAct.enabled?"enabled":"disabled"}.`)),JSON.stringify(e.layout.extraCheckAct.text)!==JSON.stringify(t.layout.extraCheckAct.text)&&(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push("Check/Act comments updated.")),o(e.layout.extraCheckAct.canEdit,t.layout.extraCheckAct.canEdit)||(r["Metrics & Objectives"]=r["Metrics & Objectives"]||[],r["Metrics & Objectives"].push("(OWNER) Check/Act edit permissions changed.")))}catch(e){}try{e.layout&&t.layout&&e.layout.extraCheckAct&&t.layout.extraCheckAct&&(e.layout.extraCheckAct.enabled!==t.layout.extraCheckAct.enabled&&(r.Objectives=r.Objectives||[],r.Objectives.push(`Check/Act comment section ${e.layout.extraCheckAct.enabled?"enabled":"disabled"}.`)),JSON.stringify(e.layout.extraCheckAct.text)!==JSON.stringify(t.layout.extraCheckAct.text)&&(r.Objectives=r.Objectives||[],r.Objectives.push("Check/Act comments updated.")),o(e.layout.extraCheckAct.canEdit,t.layout.extraCheckAct.canEdit)||(r.Objectives=r.Objectives||[],r.Objectives.push("(OWNER) Check/Act edit permissions changed.")))}catch(e){}}return{changelog:r}}catch(e){return{changelog:{General:["Changelog generation failed."]}}}}(h,m&&a[r][m]?.snapshot||null);a[r][f]={snapshot:h,meta:{ts:Date.now(),changelog:g||{}}},n.default.writeFileSync(i,JSON.stringify(a,null,2),"utf8");let y=u.findIndex(e=>e.header&&e.header.id&&e.header.id.split("-")[1]===r);if(-1!==y){let t=u[y].header.id,r=u[y].header.id.split("-");r[2]=f;let i=r.join("-");u[y].header.id=i;for(let e=0;e<u.length;e++)if(u[e]&&u[e].header&&e!==y){if(Array.isArray(u[e].header.refs)){let r=!1;u[e].header.refs=u[e].header.refs.map(e=>e===t?(r=!0,i):e),r&&(u[e].header.refs=Array.from(new Set(u[e].header.refs)))}if(Array.isArray(u[e].header.refBy)){let r=!1;u[e].header.refBy=u[e].header.refBy.map(e=>e===t?(r=!0,i):e),r&&(u[e].header.refBy=Array.from(new Set(u[e].header.refBy)))}}n.default.writeFileSync(e,JSON.stringify(u,null,2),"utf8")}return t.status(201).json({version:f,meta:a[r][f].meta})}return t.status(405).json({error:"Method not allowed"})}var h=e.i(30710),p=e.i(7031),m=e.i(81927);let f=(0,a.hoist)(h,"default"),g=(0,a.hoist)(h,"config"),y=new i.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/a3s/[series]/versions/index",pathname:"/api/a3s/[series]/versions",bundlePath:"",filename:""},userland:h,distDir:".next",relativeProjectDir:""});async function S(e,r,i){let a="/api/a3s/[series]/versions/index";a=a.replace(/\/index$/,"")||"/";let n=await y.prepare(e,r,{srcPage:a});if(!n){r.statusCode=400,r.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve());return}let{query:s,params:c,prerenderManifest:l,routerServerContext:o}=n;try{let t=e.method||"GET",i=(0,p.getTracer)(),a=i.getActiveScopeSpan(),n=y.instrumentationOnRequestError.bind(y),d=async a=>y.render(e,r,{query:{...s,...c},params:c,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:y.isDev,page:"/api/a3s/[series]/versions/index",internalRevalidate:null==o?void 0:o.revalidate,onError:(...t)=>n(e,...t)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let n=i.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=n.get("next.route");if(s){let e=`${t} ${s}`;a.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),a.updateName(e)}else a.updateName(`${t} ${e.url}`)});a?await d(a):await i.withPropagatedContext(e.headers,()=>i.trace(m.BaseServerSpan.handleRequest,{spanName:`${t} ${e.url}`,kind:p.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},d))}catch(e){if(y.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==i.waitUntil||i.waitUntil.call(i,Promise.resolve())}}}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_pages-api_e5fe15e5.js.map