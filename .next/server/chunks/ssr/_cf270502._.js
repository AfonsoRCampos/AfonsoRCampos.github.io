module.exports=[43723,a=>{"use strict";a.s(["default",()=>d]);var b=a.i(87924),c=a.i(72131);function d({id:a,value:d,onChange:e,width:f="100%",height:g="2.5em",borderColor:h="var(--main)",bgColor:i="white",hoverColor:j="white",style:k={},placeholder:l="Enter text...",min:m,max:n,...o}){let[p,q]=c.default.useState(!1),r=o.options,s={width:f,height:g,border:`1px solid ${h}`,background:p?j:i,borderRadius:"6px",padding:"0.25em 0.75em",fontSize:"1em",transition:"background 0.2s, border-color 0.2s",boxSizing:"border-box",color:"black",...k};return r&&Array.isArray(r)?(0,b.jsx)("select",{id:a,value:d,onChange:e,style:s,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),...o,placeholder:l,children:r.map((a,c)=>{if("string"==typeof a)return(0,b.jsx)("option",{value:a,children:a},c);let d=!!a.disabled,e=a.title||void 0;return(0,b.jsx)("option",{value:a.value,disabled:d,title:e,children:a.label??a.value},c)})}):(0,b.jsx)("input",{id:a,type:o.type||"text",value:d,onChange:a=>{if(e){if(("number"===o.type||"numeric"===o.inputMode||"decimal"===o.inputMode)&&(void 0!==m||void 0!==n)){let b=a?.target?.value??"";if(""===b)return void e({target:{value:""}});let c=parseFloat(b);if(Number.isNaN(c))return void e(a);let d=c;return void 0!==m&&(d=Math.max(Number(m),d)),void 0!==n&&(d=Math.min(Number(n),d)),void(d!==c?e({target:{value:String(d)}}):e(a))}e(a)}},placeholder:l,style:s,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),min:m,max:n,...o})}},15898,(a,b,c)=>{function d(a){return b.exports=d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b.exports.__esModule=!0,b.exports.default=b.exports,d(a)}b.exports=d,b.exports.__esModule=!0,b.exports.default=b.exports},59942,(a,b,c)=>{var d=a.r(15898).default;b.exports=function(a,b){if("object"!=d(a)||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var e=c.call(a,b||"default");if("object"!=d(e))return e;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)},b.exports.__esModule=!0,b.exports.default=b.exports},71003,(a,b,c)=>{var d=a.r(15898).default,e=a.r(59942);b.exports=function(a){var b=e(a,"string");return"symbol"==d(b)?b:b+""},b.exports.__esModule=!0,b.exports.default=b.exports},41415,(a,b,c)=>{var d=a.r(71003);b.exports=function(a,b,c){return(b=d(b))in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a},b.exports.__esModule=!0,b.exports.default=b.exports},19779,a=>{"use strict";a.s(["default",()=>o]);var b=a.i(87924),c=a.i(72131),d=a.i(41163),e=a.i(59255),f=a.i(27739),g=a.i(11840),h=a.i(50257),i=a.i(67156),j=a.i(53411),k=a.i(1087),l=a.i(79944),m=a.i(50944),n=a.i(97168);function o(){let{user:a}=(0,f.useUser)(),{a3s:o,setA3s:p}=(0,g.useA3s)(),q={published:!1,draft:!0,header:{id:"",title:"",owner:a,team:[a],lastUpdated:new Date().toISOString(),by:a,start:null,end:null,refBy:[],refs:[]},probDef:{why:"",where:"",extra:"",canEdit:[a]},currentState:{nodes:[],edges:[],canEdit:[a]},actionPlan:{nodes:[],edges:[],canEdit:[a]},actionsSettings:{weighted:!1},actions:[],layout:{sections:{plan1:20,plan2:60,futureState:0,do1:70,checkAct:30},includeFutureState:!1,canEdit:[a],extraCurrentState:{enabled:!1,text:[]},extraCheckAct:{enabled:!1,text:[]}},metrics:{lag:{metricName:"",unit:"",initial:null,target:{type:""},data:[],placeholder:{initial:"",target:"",up:null},display:{enabled:!0,graphType:"simple",showOverlay:!0,showGrid:!1,freq:"monthly"}},leads:[],canEditObjectives:[a],canEditMetrics:[a]},progress:[]},[r,s]=(0,c.useState)(q),[t,u]=(0,c.useState)(null),[v,w]=(0,h.default)(),[x,y]=(0,h.default)(),[z,A]=(0,h.default)(),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),F=c.default.useRef(null),G=(0,m.useRouter)();(0,c.useEffect)(()=>{let a=r?.header?.start,b=r?.header?.end;if(!a||!b||!r?.metrics)return;let c=c=>{let d={daily:0,weekly:1,monthly:2},e={days:0,weeks:1,months:2},f=(a,b)=>!b||(d[a]??0)>=(e[b]??0);return f("daily",c)&&!(0,i.shouldDisableFrequency)(a,b,"daily",100)?"daily":f("weekly",c)&&!(0,i.shouldDisableFrequency)(a,b,"weekly",100)?"weekly":f("monthly",c)&&!(0,i.shouldDisableFrequency)(a,b,"monthly",100)?"monthly":null},d=!1,e="function"==typeof structuredClone?structuredClone(r):JSON.parse(JSON.stringify(r));e.metrics=e.metrics||{};let f=e.metrics.lag||{},g=Array.isArray(f.data)?f.data:[];if(g&&0!==g.length)try{let a=e.metrics.lag.data[0]||{},b=void 0===a.value?null:a.value,c=void 0!==e.metrics.lag?.initial?e.metrics.lag.initial:null,f=null!==b&&""!==b&&Number.isFinite(Number(b))?Number(b):null,g=null!==c&&""!==c&&Number.isFinite(Number(c))?Number(c):null;f!==g&&(e.metrics.lag.data[0]={...e.metrics.lag.data[0]||{},value:g},d=!0)}catch(a){}else{let f=e.metrics.lag?.target?.granularity||null,g=e.metrics.lag?.display?.freq||c(f);if(g){let c=(0,i.generateBuckets)(a,b,g),f=void 0!==e.metrics.lag?.initial?e.metrics.lag.initial:null;e.metrics.lag={...e.metrics.lag||{},data:c.map((a,b)=>({date:a,value:0===b&&null!==f&&""!==f?f:null})),display:{...e.metrics.lag.display||{},freq:g}},d=!0}}e.metrics.leads=e.metrics.leads||[];for(let f=0;f<e.metrics.leads.length;f++){let g=e.metrics.leads[f]||{},h=Array.isArray(g.data)?g.data:[];if(h&&0!==h.length)try{let a=e.metrics.leads[f].data[0]||{},b=void 0===a.value?null:a.value,c=void 0!==e.metrics.leads[f]?.initial?e.metrics.leads[f].initial:null,g=null!==b&&""!==b&&Number.isFinite(Number(b))?Number(b):null,h=null!==c&&""!==c&&Number.isFinite(Number(c))?Number(c):null;g!==h&&(e.metrics.leads[f].data[0]={...e.metrics.leads[f].data[0]||{},value:h},d=!0)}catch(a){}else{let h=g?.target?.granularity||null,j=g.display?.freq||c(h);if(j){let c=(0,i.generateBuckets)(a,b,j),h=void 0!==g?.initial?g.initial:null;e.metrics.leads[f]={...e.metrics.leads[f]||{},data:c.map((a,b)=>({date:a,value:0===b&&null!==h&&""!==h?Number(h):null})),display:{...e.metrics.leads[f].display||{},freq:j}},d=!0}}}d&&s(e)},[r,s]);let H=async()=>{try{E(!0);let a="function"==typeof structuredClone?structuredClone(r):JSON.parse(JSON.stringify(r));a.draft=!0,a.published=!1,a.header=a.header||{},a.header.lastUpdated=new Date().toISOString();let b=await fetch("/api/a3s",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await b.text();console.error("Failed to save draft",b.status,a);return}let c=await b.json()||a;s(c);try{if("function"==typeof p){let a=await fetch("/api/a3s");if(a.ok){let b=await a.json();p(Array.isArray(b)?b:[])}else p(a=>{let b=Array.isArray(a)?a.slice():[],d=b.findIndex(a=>a?.header?.id===c?.header?.id);return d>=0?b[d]=c:b.push(c),b})}}catch(a){console.warn("Could not refresh global A3 list",a)}G.push("/home")}catch(a){console.error("Error saving draft",a),G.push("/home")}finally{E(!1)}},I={height:"5vh",alignItems:"center",justifyContent:"center",display:"flex",border:"none",borderRadius:6,cursor:"pointer",color:"white",fontWeight:"bold"};return(0,b.jsxs)("div",{style:{width:"100vw",minHeight:"100vh",padding:"1em",boxSizing:"border-box",justifySelf:"center",alignItems:"center",display:"flex",flexDirection:"column",background:"#f0f0f0",gap:"6px"},children:[(0,b.jsx)(e.default,{a3:r,setA3:s,activeArea:t,setActiveArea:u,boundsPreview:A,refPlan2:v,boundsPlan2:w,refPlan4:x,boundsPlan4:y}),(0,b.jsx)(l.default,{a3:r,setA3:s,activeArea:{0:"header",1:"probDef",2:"currentState",3:"objectives",4:"actionPlan",5:null,6:"metrics"}[t],setShowLayout:C,width:A.width,color:t?[["var(--blue-highlight)","var(--blue-highlight)",,"var(--blue)"],["var(--accent-highlight)","var(--accent-highlight)","var(--accent)"],["white","var(--accent-highlight)","var(--accent)"],["var(--accent-highlight)","var(--accent-highlight)","var(--accent)"],["white","var(--accent-highlight)","var(--accent)"],["var(--green-highlight)","var(--green-highlight)","var(--green)"],["var(--orange-highlight)","var(--orange-highlight)","var(--orange)"]][t][2]:void 0}),(0,b.jsx)(d.default,{a3:r,setA3:s,activeArea:t,setActiveArea:u,refPlan2:v,boundsPlan2:w,refPlan4:x,boundsPlan4:y,refPreview:z,boundsPreview:A,showLayout:B,setShowLayout:C,toggleImgSelectorCurrent:()=>{imagePickerTarget.current="currentState",setImagePickerOpen(!0)},toggleImgSelectorActionPlan:()=>{imagePickerTarget.current="actionPlan",setImagePickerOpen(!0)},editable:!0,owner:!0}),(0,b.jsxs)("div",{style:{width:A.width,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,b.jsx)("button",{ref:F,onClick:()=>C(a=>!a),"aria-expanded":B,"aria-label":"Layout settings",style:{...I,aspectRatio:"1/1",backgroundColor:"var(--main-highlight)"},children:(0,b.jsx)(n.FaGear,{})}),(0,b.jsx)(j.default,{a3:r,setA3:s,open:B,onClose:()=>C(!1),anchorRef:F})]}),(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,b.jsx)(k.default,{a3:r,setA3:s,style:{...I,padding:"6px",backgroundColor:"var(--main)"}}),(0,b.jsx)("button",{onClick:H,disabled:D,style:{...I,backgroundColor:"var(--main-highlight)",padding:"6px"},children:D?"Savingâ€¦":"Save Draft"})]})]})]})}},47303,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_dompurify_dist_purify_es_mjs_08294729._.js"].map(b=>a.l(b))).then(()=>b(37132)))},93643,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_quill_dist_quill_d47e2798.js"].map(b=>a.l(b))).then(()=>b(58136)))}];

//# sourceMappingURL=_cf270502._.js.map