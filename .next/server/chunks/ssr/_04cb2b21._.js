module.exports=[43723,a=>{"use strict";a.s(["default",()=>d]);var b=a.i(87924),c=a.i(72131);function d({id:a,value:d,onChange:e,width:f="100%",height:g="2.5em",borderColor:h="var(--main)",bgColor:i="white",hoverColor:j="white",style:k={},placeholder:l="Enter text...",min:m,max:n,...o}){let[p,q]=c.default.useState(!1),r=o.options,s={width:f,height:g,border:`1px solid ${h}`,background:p?j:i,borderRadius:"6px",padding:"0.25em 0.75em",fontSize:"1em",transition:"background 0.2s, border-color 0.2s",boxSizing:"border-box",color:"black",...k};return r&&Array.isArray(r)?(0,b.jsx)("select",{id:a,value:d,onChange:e,style:s,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),...o,placeholder:l,children:r.map((a,c)=>{if("string"==typeof a)return(0,b.jsx)("option",{value:a,children:a},c);let d=!!a.disabled,e=a.title||void 0;return(0,b.jsx)("option",{value:a.value,disabled:d,title:e,children:a.label??a.value},c)})}):(0,b.jsx)("input",{id:a,type:o.type||"text",value:d,onChange:a=>{if(e){if(("number"===o.type||"numeric"===o.inputMode||"decimal"===o.inputMode)&&(void 0!==m||void 0!==n)){let b=a?.target?.value??"";if(""===b)return void e({target:{value:""}});let c=parseFloat(b);if(Number.isNaN(c))return void e(a);let d=c;return void 0!==m&&(d=Math.max(Number(m),d)),void 0!==n&&(d=Math.min(Number(n),d)),void(d!==c?e({target:{value:String(d)}}):e(a))}e(a)}},placeholder:l,style:s,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),min:m,max:n,...o})}},15898,(a,b,c)=>{function d(a){return b.exports=d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b.exports.__esModule=!0,b.exports.default=b.exports,d(a)}b.exports=d,b.exports.__esModule=!0,b.exports.default=b.exports},59942,(a,b,c)=>{var d=a.r(15898).default;b.exports=function(a,b){if("object"!=d(a)||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var e=c.call(a,b||"default");if("object"!=d(e))return e;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)},b.exports.__esModule=!0,b.exports.default=b.exports},71003,(a,b,c)=>{var d=a.r(15898).default,e=a.r(59942);b.exports=function(a){var b=e(a,"string");return"symbol"==d(b)?b:b+""},b.exports.__esModule=!0,b.exports.default=b.exports},41415,(a,b,c)=>{var d=a.r(71003);b.exports=function(a,b,c){return(b=d(b))in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a},b.exports.__esModule=!0,b.exports.default=b.exports},57218,a=>{"use strict";a.s(["default",()=>p]);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(27739),f=a.i(11840),g=a.i(59255),h=a.i(50257),i=a.i(67156),j=a.i(53411),k=a.i(1087),l=a.i(41163),m=a.i(79944),n=a.i(97168),o=a.i(96387);function p(){let a=(0,d.useParams)(),p=(0,d.useRouter)(),{user:q}=(0,e.useUser)(),{a3s:r=[],setA3s:s}=(0,f.useA3s)(),t=a?.id||"",[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!1),[A,B]=(0,h.default)(),[C,D]=(0,h.default)(),[E,F]=(0,h.default)(),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),K=c.default.useRef(null),[L,M]=(0,c.useState)(!1);if((0,c.useEffect)(()=>{let a=a=>{if(!a)return!1;try{return!!Array.isArray(a)&&!!q&&a.includes(q)}catch(a){return!1}},b=(r||[]).find(a=>a?.header?.id===t)||null;if(!b)return;let c=b.header?.owner,d=Array.isArray(b.header?.team)?b.header.team:[];if(!(c===q||d.includes(q)))return void p.push("/home");try{let d=(0,o.ensureLateFlagsForA3)(b);d=(0,o.ensureProgressForA3)(d);let e=JSON.stringify(d)!==JSON.stringify(b);z(c===q),v(d),M(c===q||a(d.layout?.canEdit)),e&&(async()=>{try{let a=await fetch("/api/a3s",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!a.ok){let b=await a.text().catch(()=>"");console.warn("Auto-save late flags/progress failed",a.status,b)}}catch(a){console.warn("Auto-save late flags/progress error",a)}})()}catch(d){z(c===q),v(b),M(c===q||a(b.layout?.canEdit))}},[r,t,p,q]),(0,c.useEffect)(()=>{let a=u?.header?.start,b=u?.header?.end;if(!a||!b||!u?.metrics)return;let c=c=>{let d={daily:0,weekly:1,monthly:2},e={days:0,weeks:1,months:2},f=(a,b)=>!b||(d[a]??0)>=(e[b]??0);return f("daily",c)&&!(0,i.shouldDisableFrequency)(a,b,"daily",100)?"daily":f("weekly",c)&&!(0,i.shouldDisableFrequency)(a,b,"weekly",100)?"weekly":f("monthly",c)&&!(0,i.shouldDisableFrequency)(a,b,"monthly",100)?"monthly":null},d=!1,e="function"==typeof structuredClone?structuredClone(u):JSON.parse(JSON.stringify(u));e.metrics=e.metrics||{};let f=e.metrics.lag||{},g=Array.isArray(f.data)?f.data:[];if(g&&0!==g.length)try{let a=e.metrics.lag.data[0]||{},b=void 0===a.value?null:a.value,c=void 0!==e.metrics.lag?.initial?e.metrics.lag.initial:null,f=null!==b&&""!==b&&Number.isFinite(Number(b))?Number(b):null,g=null!==c&&""!==c&&Number.isFinite(Number(c))?Number(c):null;f!==g&&(e.metrics.lag.data[0]={...e.metrics.lag.data[0]||{},value:g},d=!0)}catch(a){}else{let f=e.metrics.lag?.target?.granularity||null,g=e.metrics.lag?.display?.freq||c(f);if(g){let c=(0,i.generateBuckets)(a,b,g),f=void 0!==e.metrics.lag?.initial?e.metrics.lag.initial:null;e.metrics.lag={...e.metrics.lag||{},data:c.map((a,b)=>({date:a,value:0===b&&null!==f&&""!==f?f:null})),display:{...e.metrics.lag.display||{},freq:g}},d=!0}}e.metrics.leads=e.metrics.leads||[];for(let f=0;f<e.metrics.leads.length;f++){let g=e.metrics.leads[f]||{},h=Array.isArray(g.data)?g.data:[];if(h&&0!==h.length)try{let a=e.metrics.leads[f].data[0]||{},b=void 0===a.value?null:a.value,c=void 0!==e.metrics.leads[f]?.initial?e.metrics.leads[f].initial:null,g=null!==b&&""!==b&&Number.isFinite(Number(b))?Number(b):null,h=null!==c&&""!==c&&Number.isFinite(Number(c))?Number(c):null;g!==h&&(e.metrics.leads[f].data[0]={...e.metrics.leads[f].data[0]||{},value:h},d=!0)}catch(a){}else{let h=g?.target?.granularity||null,j=g.display?.freq||c(h);if(j){let c=(0,i.generateBuckets)(a,b,j),h=void 0!==g?.initial?g.initial:null;e.metrics.leads[f]={...e.metrics.leads[f]||{},data:c.map((a,b)=>({date:a,value:0===b&&null!==h&&""!==h?Number(h):null})),display:{...e.metrics.leads[f].display||{},freq:j}},d=!0}}}d&&v(e)},[u,v]),!q)return null;if(!u)return(0,b.jsx)("div",{style:{padding:24,textAlign:"center"},children:"Loading A3 for editâ€¦"});let N=async()=>{try{J(!0);let a="function"==typeof structuredClone?structuredClone(u):JSON.parse(JSON.stringify(u));a.draft=u.draft,a.published=u.published,a.header=a.header||{},a.header.lastUpdated=new Date().toISOString();let b=await fetch("/api/a3s",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await b.text();console.error("Failed to update A3",b.status,a);return}let c=await b.json(),d=c||a;v(d);try{if("function"==typeof s){let a=await fetch("/api/a3s");if(a.ok){let b=await a.json();s(Array.isArray(b)?b:[])}else s(a=>{let b=Array.isArray(a)?a.slice():[],c=b.findIndex(a=>a?.header?.id===d?.header?.id);return c>=0?b[c]=d:b.push(d),b})}}catch(a){console.warn("Could not refresh global A3 list",a)}console.log("A3 updated",c),p.push("/home")}catch(a){console.error("Error updating A3",a),p.push("/home")}finally{J(!1)}},O=async()=>{N();try{J(!0);let a=u?.header?.id?.split("-")?.[1];if(!a)return void console.error("Cannot determine series id for versioning");let b={author:q||null,message:`Version from ${q||"unknown"}`},c=await fetch(`/api/a3s/${a}/versions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.text();console.error("Failed to create version",c.status,a);return}let d=await c.json(),e=d?.version;v(a=>{if(!a)return a;let b="function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a));if(b.header&&"string"==typeof b.header.id){let a=b.header.id.split("-");a[2]=e,b.header.id=a.join("-"),b.header.lastUpdated=new Date().toISOString(),b.published=!0,b.draft=!1}return b});try{if("function"==typeof s){let a=await fetch("/api/a3s");if(a.ok){let b=await a.json();s(Array.isArray(b)?b:[])}}}catch(a){console.warn("Could not refresh global A3 list after versioning",a)}p.push("/home")}catch(a){console.error("Error creating version",a)}finally{J(!1)}},P={height:"5vh",alignItems:"center",justifyContent:"center",display:"flex",border:"none",borderRadius:6,cursor:"pointer",color:"white",fontWeight:"bold"};return(0,b.jsxs)("div",{style:{width:"100vw",minHeight:"100vh",padding:"1em",boxSizing:"border-box",justifySelf:"center",alignItems:"center",display:"flex",flexDirection:"column",background:"#f0f0f0",gap:"6px"},children:[(0,b.jsx)(g.default,{a3:u,setA3:v,activeArea:w,setActiveArea:x,boundsPreview:F,refPlan2:A,boundsPlan2:B,refPlan4:C,boundsPlan4:D}),y&&(0,b.jsx)(m.default,{a3:u,setA3:v,activeArea:{0:"header",1:"probDef",2:"currentState",3:"objectives",4:"actionPlan",5:null,6:"metrics"}[w],setShowLayout:H,width:F.width,color:w?[["var(--blue-highlight)","var(--blue-highlight)",,"var(--blue)"],["var(--accent-highlight)","var(--accent-highlight)","var(--accent)"],["white","var(--accent-highlight)","var(--accent)"],["var(--accent-highlight)","var(--accent-highlight)","var(--accent)"],["white","var(--accent-highlight)","var(--accent)"],["var(--green-highlight)","var(--green-highlight)","var(--green)"],["var(--orange-highlight)","var(--orange-highlight)","var(--orange)"]][w][2]:void 0}),(0,b.jsx)(l.default,{a3:u,setA3:v,activeArea:w,setActiveArea:x,refPlan2:A,boundsPlan2:B,refPlan4:C,boundsPlan4:D,refPreview:E,boundsPreview:F,showLayout:G,setShowLayout:H,toggleImgSelectorCurrent:()=>{imagePickerTarget.current="currentState",setImagePickerOpen(!0)},toggleImgSelectorActionPlan:()=>{imagePickerTarget.current="actionPlan",setImagePickerOpen(!0)},editable:!0,owner:y}),(0,b.jsxs)("div",{style:{width:F.width,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8},children:L&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{ref:K,onClick:()=>H(a=>!a),"aria-expanded":G,"aria-label":"Layout settings",style:{...P,aspectRatio:"1/1",backgroundColor:"var(--main-highlight)"},children:(0,b.jsx)(n.FaGear,{})}),(0,b.jsx)(j.default,{a3:u,setA3:v,open:G,onClose:()=>H(!1),anchorRef:K})]})}),(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[u.draft&&y&&(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(k.default,{a3:u,setA3:v,style:{...P,padding:"6px",backgroundColor:"var(--main)"}})}),u.published&&y&&(0,b.jsx)("button",{onClick:O,disabled:I||!y,style:{...P,backgroundColor:"var(--main)",padding:"6px"},children:I?"Creating version...":"New Version"}),(0,b.jsx)("button",{onClick:N,disabled:I,style:{...P,backgroundColor:"var(--main-highlight)",padding:"6px"},children:I?"Updating...":"Update"})]})]})]})}},93643,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_quill_dist_quill_d47e2798.js"].map(b=>a.l(b))).then(()=>b(58136)))},47303,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_dompurify_dist_purify_es_mjs_08294729._.js"].map(b=>a.l(b))).then(()=>b(37132)))}];

//# sourceMappingURL=_04cb2b21._.js.map