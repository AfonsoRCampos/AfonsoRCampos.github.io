module.exports=[15898,(a,b,c)=>{function d(a){return b.exports=d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b.exports.__esModule=!0,b.exports.default=b.exports,d(a)}b.exports=d,b.exports.__esModule=!0,b.exports.default=b.exports},43723,a=>{"use strict";a.s(["default",()=>d]);var b=a.i(87924),c=a.i(72131);function d({id:a,value:d,onChange:e,width:f="100%",height:g="2.5em",borderColor:h="var(--main)",bgColor:i="white",hoverColor:j="white",style:k={},placeholder:l="Enter text...",min:m,max:n,...o}){let[p,q]=c.default.useState(!1),r=o.options,s={width:f,height:g,border:`1px solid ${h}`,background:p?j:i,borderRadius:"6px",padding:"0.25em 0.75em",fontSize:"1em",transition:"background 0.2s, border-color 0.2s",boxSizing:"border-box",color:"black",...k};return r&&Array.isArray(r)?(0,b.jsx)("select",{id:a,value:d,onChange:e,style:s,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),...o,placeholder:l,children:r.map((a,c)=>{if("string"==typeof a)return(0,b.jsx)("option",{value:a,children:a},c);let d=!!a.disabled,e=a.title||void 0;return(0,b.jsx)("option",{value:a.value,disabled:d,title:e,children:a.label??a.value},c)})}):(0,b.jsx)("input",{id:a,type:o.type||"text",value:d,onChange:a=>{if(e){if(("number"===o.type||"numeric"===o.inputMode||"decimal"===o.inputMode)&&(void 0!==m||void 0!==n)){let b=a?.target?.value??"";if(""===b)return void e({target:{value:""}});let c=parseFloat(b);if(Number.isNaN(c))return void e(a);let d=c;return void 0!==m&&(d=Math.max(Number(m),d)),void 0!==n&&(d=Math.min(Number(n),d)),void(d!==c?e({target:{value:String(d)}}):e(a))}e(a)}},placeholder:l,style:s,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),min:m,max:n,...o})}},66615,a=>{"use strict";a.s(["default",()=>k]);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(27739),f=a.i(11840),g=a.i(50257),h=a.i(41163),i=a.i(82524);a.i(43723);var j=a.i(96387);function k(){let a=(0,d.useParams)(),k=(0,d.useRouter)(),{user:l}=(0,e.useUser)(),{a3s:m=[]}=(0,f.useA3s)(),n=a?.id||"",[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)("CURRENT"),[y,z]=(0,c.useState)("A3"),[A,B]=(0,c.useState)(!1),[C,D]=(0,g.default)();return((0,c.useEffect)(()=>{let a=(m||[]).find(a=>a?.header?.id===n)||null;if(!a)return;let b=a.header?.owner,c=Array.isArray(a.header?.team)?a.header.team:[];if(!(b===l||c.includes(l)))return void k.push("/home");try{let b=(0,j.ensureLateFlagsForA3)(a);b=(0,j.ensureProgressForA3)(b);let c=JSON.stringify(b)!==JSON.stringify(a);p(b),r(b),c&&(async()=>{try{let a=await fetch("/api/a3s",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!a.ok){let b=await a.text().catch(()=>"");console.warn("Auto-save late flags/progress failed",a.status,b)}}catch(a){console.warn("Auto-save late flags/progress error",a)}})()}catch(b){p(a),r(a)}},[m,n,k,l]),(0,c.useEffect)(()=>{if(!o)return;let a=(o.header?.id||"").split("-");if(a.length<3)return;let b=a[1];v(!0),fetch(`/api/a3s/${b}/versions`).then(a=>a.json()).then(a=>{let b=a||{},c={};b.versions&&"object"==typeof b.versions?c=b.versions:Object.keys(b).forEach(a=>{"history"!==a&&"currentVersion"!==a&&b[a]&&b[a].snapshot&&(c[a]=b[a])});let d=Object.keys(c).map(a=>({label:a,snapshot:c[a].snapshot||null,meta:c[a].meta||{}}));d.sort((a,b)=>(b.meta?.ts||0)-(a.meta?.ts||0)),t(d)}).catch(()=>t([])).finally(()=>v(!1))},[o]),q)?(0,b.jsxs)("main",{style:{padding:16,display:"flex",gap:16},children:[(0,b.jsx)("div",{style:{flex:"0 0 80%",minWidth:0,display:"flex",flexDirection:"column",gap:12},children:(0,b.jsx)("div",{style:{flex:1,minWidth:0,justifyContent:"center",alignItems:"center",display:"flex"},children:(0,b.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,b.jsx)(h.default,{a3:q,refPreview:C,boundsPreview:D,setA3:()=>{},setActiveArea:()=>{},setShowLayout:()=>{},toggleImgSelectorCurrent:()=>{},toggleImgSelectorActionPlan:()=>{},editable:!1})})})}),(0,b.jsxs)("aside",{style:{flex:"1 1 30%",boxSizing:"border-box",borderLeft:"1px solid rgba(0,0,0,0.06)",paddingLeft:12,display:"flex",flexDirection:"column",height:"calc(100vh - 32px)"},children:[(0,b.jsx)("h3",{style:{marginTop:0},children:"Versions"}),u?(0,b.jsx)("div",{children:"Loading versions…"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:8,paddingRight:8},children:[(0,b.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,b.jsxs)("div",{onClick:()=>{r(o),x("CURRENT")},style:{padding:8,borderRadius:6,background:"CURRENT"===w?"#eef":"transparent",cursor:"pointer",display:"flex",flexDirection:"column",gap:6,flex:1},children:[(0,b.jsx)("div",{style:{fontWeight:"bold"},children:"Current"}),(0,b.jsx)("div",{style:{color:"#444",fontSize:12},children:new Date(o.header?.ts||o.header?.updated||Date.now()).toLocaleString()}),(0,b.jsx)("div",{style:{color:"#666",fontSize:12},children:"Live (uncommitted)"})]})}),0===s.length&&(0,b.jsx)("div",{style:{color:"#666"},children:"No versions yet."}),s.map(a=>(0,b.jsxs)("div",{style:{padding:8,borderRadius:6,background:w===a.label?"#eef":"transparent",cursor:"pointer",display:"flex",flexDirection:"column",gap:6},onClick:()=>{r(a.snapshot||o),x(a.label)},children:[(0,b.jsx)("div",{style:{fontWeight:"bold"},children:a.label}),(0,b.jsx)("div",{style:{color:"#444",fontSize:12},children:new Date(a.meta?.ts||0).toLocaleString()}),(0,b.jsx)("div",{style:{color:"#666",fontSize:12,textAlign:"left"},children:a.meta?.changelog&&Object.keys(a.meta.changelog).length>0?Object.entries(a.meta.changelog).map(([a,c])=>(0,b.jsxs)("div",{style:{marginBottom:6},children:[(0,b.jsx)("div",{style:{fontWeight:"600"},children:a}),Array.isArray(c)&&c.length>0?(0,b.jsx)("ul",{style:{margin:"4px 0 0 1em",padding:0},children:c.map((a,c)=>(0,b.jsx)("li",{style:{listStyle:"disc",marginLeft:"1em",fontSize:12},children:a},c))}):null]},a)):(0,b.jsx)("div",{children:a.meta?.message||""})})]},a.label))]}),(0,b.jsx)("div",{style:{borderTop:"1px solid rgba(0,0,0,0.06)",paddingTop:8,marginTop:8,display:"flex",justifyContent:"flex-end",gap:8,alignItems:"center"},children:(0,b.jsx)("button",{onClick:()=>{B(!0)},style:{height:"5vh",alignItems:"center",justifyContent:"center",display:"flex",border:"none",borderRadius:6,cursor:"pointer",color:"white",fontWeight:"bold",backgroundColor:"var(--main)",padding:"6px",width:"100%"},children:A?"Downloading...":"Download"})})]})]}),A&&(0,b.jsx)(i.default,{a3:q,format:y,onFinish:()=>B(!1)})]}):(0,b.jsx)("div",{style:{padding:24},children:"Loading A3…"})}},47303,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_dompurify_dist_purify_es_mjs_08294729._.js"].map(b=>a.l(b))).then(()=>b(37132)))},93042,a=>{a.v(a=>Promise.resolve().then(()=>a(33926)))},98523,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_@babel_runtime_helpers_85cd5dbc._.js","server/chunks/ssr/node_modules_fa8b88e1._.js"].map(b=>a.l(b))).then(()=>b(57058)))}];

//# sourceMappingURL=_75dc5356._.js.map