module.exports=[61107,a=>{"use strict";a.s(["default",()=>E],61107);var b=a.i(87924),c=a.i(72131),d=a.i(328),e=a.i(42343);function f(a){return(0,e.GenIcon)({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(a)}var g=a.i(97168),h=a.i(27739),i=a.i(11840),j=a.i(50944),k=a.i(27731),l=a.i(82524),m=a.i(50257),n=a.i(41212),o=a.i(28525),p=["top","left","transform","className","children","innerRef"];function q(){return(q=Object.assign.bind()).apply(this,arguments)}function r(a){var b=a.top,d=a.left,e=a.transform,f=a.className,g=a.children,h=a.innerRef,i=function(a,b){if(null==a)return{};var c,d,e={},f=Object.keys(a);for(d=0;d<f.length;d++)c=f[d],b.indexOf(c)>=0||(e[c]=a[c]);return e}(a,p);return c.default.createElement("g",q({ref:h,className:(0,o.default)("visx-group",f),transform:e||"translate("+(void 0===d?0:d)+", "+(void 0===b?0:b)+")"},i),g)}function s({progress:a=[],height:d=180,colors:e={},margin:f={top:8,right:45,bottom:27.5,left:45}}){let g={completed:e.completed||"var(--green, #39b54a)",gap:e.gap||"#ce3131ff",totalPoint:e.totalPoint||"var(--cancel, #ffe600ff)",targetLine:e.targetLine||"var(--accent, #f39c12)",todayLine:e.todayLine||"rgba(0, 0, 0, 1)"},h=a.slice(),{data:i,todayIndex:j,maxY:k}=(0,c.useMemo)(()=>{let a=h.map((a,b)=>({idx:b,date:a?.date||null,total:a&&null!=a.total?Number(a.total):null,completed:a&&null!=a.completed?Number(a.completed):null})),b=new Date().toISOString().slice(0,10),c=null;for(let d=0;d<a.length;d++){let e=a[d].date;if(e)if(e<=b)c=d;else break}null===c&&(c=Math.min(a.length-1,0));let d=null,e=a.map(a=>(null!==a.total&&Number.isFinite(a.total)&&(d=a.total),d)),f=null;for(let a=e.length-1;a>=0;a--)if(null!=e[a]){f=e[a];break}null==f&&(f=0);let g=0;for(let b=0;b<=c;b++)g=Math.max(g,e[b]||0,a[b].completed||0);return 0===g&&(g=1),{data:a,todayIndex:c,maxY:g}},[h]),[l,n]=(0,m.default)(),o=Math.max(300,Math.floor(n.width||760)),p=Math.max(10,o-f.left-f.right),q=Math.max(10,d-f.top-f.bottom),s=a=>f.left+p*(a/Math.max(1,i.length-1)),t=a=>f.top+q-(a||0)/k*q,u=a=>f.top+q-(a||0)/100*q,v=o>=320,w=o>=240,x=o>=420?4:o>=360?2:1,y=(()=>{let a=[];for(let b=0;b<=x;b++){let c=Math.round(k*b/x*100)/100;a.push(c)}return a.reverse()})(),z=(()=>{if(!i||0===i.length)return[];let a=i.length;if(o>=420)return[0,Math.round((a-1)*.25),Math.round((a-1)*.5),Math.round((a-1)*.75),a-1];if(o>=360)return[0,Math.round((a-1)*.5),a-1];let b=[0,a-1],c="number"==typeof j?Math.min(j,a-1):null;return null==c||b.includes(c)||b.splice(1,0,c),b})(),A=a=>a&&null!=a.total?a.total:null,B=a=>a&&null!=a.completed&&null!=a.total&&0!==Number(a.total)?Number(a.completed)/Number(a.total)*100:null;return(0,b.jsx)("div",{ref:l,style:{width:"100%"},children:(0,b.jsxs)("svg",{width:o,height:d,children:[(0,b.jsx)("rect",{x:0,y:0,width:o,height:d,fill:"transparent"}),(0,b.jsxs)(r,{children:[y.map((a,c)=>{let d=t(a);return(0,b.jsxs)("g",{children:[(0,b.jsx)("line",{x1:f.left-6,x2:o-f.right,y1:d,y2:d,stroke:"rgba(0,0,0,0.04)",strokeWidth:1}),(0,b.jsx)("text",{x:f.left-8,y:d+4,fontSize:10,fill:"#444",textAnchor:"end",children:a})]},`yt-${c}`)}),[100,75,50,25,0].map((a,c)=>{let d=u(a);return(0,b.jsx)("g",{children:(0,b.jsx)("text",{x:o-f.right+8,y:d+4,fontSize:10,fill:"#444",textAnchor:"start",children:a})},`pt-${c}`)}),(0,b.jsx)("line",{x1:f.left,y1:d-f.bottom,x2:f.left,y2:f.top,stroke:"#444",strokeWidth:1,strokeOpacity:.6}),(0,b.jsx)("line",{x1:o-f.right,y1:d-f.bottom,x2:o-f.right,y2:f.top,stroke:"#444",strokeWidth:1,strokeOpacity:.6}),(0,b.jsx)("line",{x1:f.left,y1:d-f.bottom,x2:o-f.right,y2:d-f.bottom,stroke:"#444",strokeWidth:1,strokeOpacity:.6}),z.map(a=>{let c=s(a),e=i[a]&&i[a].date?(a=>{if(!a)return"";try{let b=new Date(a);if(isNaN(b))return a;let c=String(b.getDate()).padStart(2,"0"),d=String(b.getMonth()+1).padStart(2,"0");return`${c}/${d}`}catch(b){return a}})(i[a].date):"";return(0,b.jsx)("g",{transform:`translate(${c}, ${d-f.bottom+14})`,children:(0,b.jsx)("text",{x:0,y:0,fontSize:10,fill:"#444",textAnchor:"middle",children:e})},`xl-${a}`)}),"number"==typeof j&&i[j]&&(0,b.jsx)("g",{transform:`translate(${s(j)}, ${d-f.bottom+14})`,children:(0,b.jsx)("text",{x:0,y:0,fontSize:10,fill:"#444",textAnchor:"middle",children:"Today"})},"today-label"),w&&(0,b.jsx)("text",{x:10,y:f.top+q/2-f.bottom,fontSize:11,fill:"#444",textAnchor:"end",transform:`rotate(-90 10 ${f.top+q/2-f.bottom})`,children:"Tasks"}),w&&(0,b.jsx)("text",{x:o-11,y:f.top+q/2-f.bottom,fontSize:11,fill:"#444",textAnchor:"start",transform:`rotate(90 ${o-11} ${f.top+q/2-f.bottom})`,children:"Percent (%)"}),v&&(0,b.jsx)("text",{x:f.left+p/2,y:d-2,fontSize:11,fill:"#444",textAnchor:"middle",children:"Timeline"}),(0,b.jsx)("path",{d:(()=>{let a=[];for(let b=0;b<i.length;b++){let c=A(i[b]);null!=c&&a.push([s(b),t(c)])}if(0===a.length)return"";let b=`M ${a[0][0]} ${a[0][1]}`;for(let c=1;c<a.length;c++)b+=` L ${a[c][0]} ${a[c][1]}`;return b})(),fill:"none",stroke:g.totalPoint,strokeWidth:1.5,strokeLinecap:"round"}),(0,b.jsx)("path",{d:(()=>{let a=[];for(let b=0;b<i.length;b++){let c=B(i[b]);null!=c&&a.push([s(b),u(c)])}if(0===a.length)return"";let b=`M ${a[0][0]} ${a[0][1]}`;for(let c=1;c<a.length;c++)b+=` L ${a[c][0]} ${a[c][1]}`;return b})(),fill:"none",stroke:g.completed,strokeWidth:1.5,strokeLinecap:"round"}),i.length>0&&(0,b.jsx)("line",{x1:s(0),y1:u(0),x2:s(Math.max(0,i.length-1)),y2:u(100),stroke:g.targetLine,strokeWidth:1.5,strokeDasharray:"4 4",strokeLinecap:"round"}),(()=>{let a=new Date().toISOString().slice(0,10),c=null;for(let b=0;b<i.length;b++)if(i[b].date)if(i[b].date<=a)c=b;else break;if(null==c)return null;let e=s(c);return(0,b.jsx)("line",{x1:e,y1:f.top,x2:e,y2:d-f.bottom,stroke:g.todayLine,strokeWidth:1,strokeDasharray:"2 2"})})()]})]})})}r.propTypes={top:n.default.number,left:n.default.number,transform:n.default.string,className:n.default.string,children:n.default.node,innerRef:n.default.oneOfType([n.default.string,n.default.func,n.default.object])};var t=a.i(89841),u=a.i(72330),v=a.i(17308),w=a.i(62160),x=a.i(20908);function y({metric:a={},minHeight:c=120,minWidth:d=120,unit:e=""}){let[f,g]=(0,m.default)(),h=Math.max(d,g.width||d),i=Math.max(c,g.height||c),j=Math.max(10,Math.floor(.07*Math.min(Math.max(1,h),Math.max(1,i)))),l=Math.max(9,Math.floor(.95*j)),n=Math.max(8,Math.floor(.8*j)),o=void 0!==a.initial&&null!=a.initial?Number(a.initial):Array.isArray(a.data)&&a.data[0]?Number(a.data[0].value):null,p=null;if(Array.isArray(a.data)&&a.data.length){let b=null;for(let c of a.data){if(!c)continue;let a=c.value;if(null==a||Number.isNaN(Number(a)))continue;let d=c.date?Date.parse(c.date):NaN;Number.isFinite(d)&&(!b||d>b.dt)&&(b={dt:d,value:Number(a)})}p=b?b.value:null}let q=a&&a.target&&void 0!==a.target.value?Number(a.target.value):"number"==typeof a.target?Number(a.target):null;if(null==o||null==p||null==q||[o,p,q].some(a=>Number.isNaN(a)))return(0,b.jsx)("div",{ref:f,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#666"},children:"No data to preview"});let r=o<q,s=p?r&&p>q||!r&&p<q?0:Math.abs(q-p):Math.abs(q-o),t=p&&(r&&p>q||!r&&p<q)?Math.abs(q-p):0,y=p?r&&p<=o||!r&&p>=o?0:Math.abs(p-o)-t:0,z=[];z.push({key:"initial",label:"As Is",value:o,color:"var(--gray, #888)"}),z.push({key:"gap",label:"Gap",value:y+s+t}),z.push({key:"target",label:"To Be",value:q,color:"var(--gray, #2196f3)"});let A=Math.max(10,h-44-8),B=Math.max(10,i-18-36),C=(0,u.scaleBand)({domain:z.map(a=>a.key),range:[0,A],paddingInner:.3,paddingOuter:.1}),D=Math.max(Math.abs(o),Math.abs(p),Math.abs(q),r?Math.abs(q+t):1),E=(0,v.scaleLinear)({domain:[0,1.12*D],range:[B,0]}),F=a=>`${(0,k.formatCompact)(a)}${e?` ${e}`:""}`;return(0,b.jsx)("div",{ref:f,style:{width:"100%",height:"100%"},children:(0,b.jsxs)("svg",{width:"100%",height:"100%",viewBox:`0 0 ${h} ${i}`,style:{display:"block"},children:[(0,b.jsx)("line",{x1:44,x2:44,y1:18,y2:18+B,stroke:"#444",strokeWidth:1}),[0,.5,1].map((a,c)=>{let d=Math.round(1.12*D*a*100)/100,e=18+E(d);return(0,b.jsxs)("g",{children:[(0,b.jsx)("line",{x1:38,x2:h-8,y1:e,y2:e,stroke:"rgba(0,0,0,0.04)",strokeWidth:1}),(0,b.jsx)(x.Text,{x:36,y:e+4,fontSize:n,fill:"#444",textAnchor:"end",children:(0,k.formatCompact)(d)},`yl-${c}`)]},`yt-${c}`)}),(0,b.jsx)("line",{x1:44,x2:44+A,y1:18+B,y2:18+B,stroke:"#444",strokeWidth:1}),(()=>{let a=C.bandwidth(),c=44+(C("initial")||0),d=18+E(Math.abs(z[0].value)),e=B-E(Math.abs(z[0].value)),f=(0,b.jsxs)("g",{children:[(0,b.jsx)(w.Bar,{x:c,y:d,width:a,height:e,fill:z[0].color}),(0,b.jsx)(x.Text,{x:c+a/2,y:Math.max(12,d-6),fontSize:l,textAnchor:"middle",fill:"#111",children:F(z[0].value)}),(0,b.jsx)(x.Text,{x:c+a/2,y:18+B+16,fontSize:j,fontWeight:"bold",textAnchor:"middle",children:z[0].label})]},"bar-initial"),g=44+(C("target")||0),h=18+E(Math.abs(z[2].value)),i=B-E(Math.abs(z[2].value)),m=(0,b.jsxs)("g",{children:[(0,b.jsx)(w.Bar,{x:g,y:h,width:a,height:i,fill:z[2].color}),(0,b.jsx)(x.Text,{x:g+a/2,y:Math.max(12,h-6),fontSize:l,textAnchor:"middle",fill:"#111",children:F(z[2].value)}),(0,b.jsx)(x.Text,{x:g+a/2,y:18+B+16,fontSize:j,fontWeight:"bold",textAnchor:"middle",children:z[2].label})]},"bar-target"),u=44+(C("gap")||0),v=[];r?(y>0&&v.push({key:"completed",value:y,color:"var(--green, #39b54a)",label:"Completed"}),s>0&&v.push({key:"debt",value:s,color:"var(--cancel, #e74c3c)",label:"Remaining"}),t>0&&v.push({key:"extra",value:t,color:"var(--green-dark, #f39c12)",label:"Extra"})):(t>0&&v.push({key:"extra",value:t,color:"var(--green-dark, #f39c12)",label:"Extra"}),s>0&&v.push({key:"debt",value:s,color:"var(--cancel, #e74c3c)",label:"Remaining"}),y>0&&v.push({key:"completed",value:y,color:"var(--green, #39b54a)",label:"Completed"}));let A=0;A=r?Math.min(o,p):q-t;let D=0;return[f,(0,b.jsxs)("g",{children:[v.map(c=>{if(!c||!c.value)return null;let d=A+D,e=18+E(A+D+c.value),f=18+E(d)-e;return D+=c.value,(0,b.jsxs)("g",{children:[(0,b.jsx)(w.Bar,{x:u,y:e,width:a,height:f,fill:c.color}),f>14&&(0,b.jsx)(x.Text,{x:u+a/2,y:e+f/2,fontSize:n,textAnchor:"middle",fill:"#fff",children:(0,k.formatCompact)(c.value)})]},`seg-${c.key}`)}),(0,b.jsx)(x.Text,{x:u+a/2,y:18+E(A+D)-6,fontSize:l,textAnchor:"middle",fill:"#111",children:F(D)}),(0,b.jsx)(x.Text,{x:u+a/2,y:18+B+16,fontSize:j,fontWeight:"bold",textAnchor:"middle",children:z[1].label})]},"bar-gap"),m]})()]})})}var z=a.i(28173);function A({a3:a=null,legend:c=!0}){let d=a?.metrics?.lag?.data.map(a=>a.date)||[],e=[...a?.metrics?.lag?.metricName?[a.metrics.lag.metricName]:[],...(a?.metrics?.leads??[]).map(a=>a.metricName)],f=e.map(b=>{let c=a?.metrics?.lag?.metricName===b?a.metrics.lag.data:(a?.metrics?.leads||[]).find(a=>a.metricName===b)?.data||[],e=a?.metrics?.lag?.metricName===b?a.metrics.lag.target:(a?.metrics?.leads||[]).find(a=>a.metricName===b)?.target||{},f=a?.metrics?.lag?.metricName===b?a.metrics.lag.initial:(a?.metrics?.leads||[]).find(a=>a.metricName===b)?.initial||null;return f=null==f?null:Number(f),(0,z.evaluateMetricAgainstDates)({data:c,dates:d,target:e,initial:f})}),g=d.map((a,b)=>{if(null===f[0][b])return null;let c=f.slice(1).map(a=>a[b]),d=c.filter(a=>null!==a).length;if(0===d)return null;let e=2*c.filter(a=>!0===a).length/d-1;return(!0===f[0][b]?e<0:e>0)?e:null});f=f.concat([g]);let h=[...e,"Evaluation"],i="var(--green, #2ecc71)",j="var(--cancel, #e74c3c)",l="var(--gray)";return(0,b.jsxs)("div",{className:"lags-leads-comparison",style:c?{display:"flex",gap:12,color:"#333"}:{display:"block",color:"#333"},children:[(0,b.jsx)("div",{style:c?{flex:"0 0 75%",overflowX:"auto"}:{flex:"1 1 100%",overflowX:"auto"},children:(0,b.jsxs)("table",{style:{borderCollapse:"collapse",width:"100%",tableLayout:"fixed"},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{style:{textAlign:"left",padding:"6px 8px",width:"20%"},children:"Metric / Date"}),d.map((a,c)=>(0,b.jsx)("th",{style:{padding:"6px 4px",fontSize:"0.5em",textAlign:"center",minWidth:20},title:a,children:(0,k.isoToDateString)(a,"DD/MM")},`dh-${c}`))]})}),(0,b.jsx)("tbody",{children:f.map((a,c)=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:{padding:"6px 8px",borderTop:"1px solid rgba(0,0,0,0.04)",verticalAlign:"middle",fontSize:13,fontWeight:c===f.length-1?700:500},children:h[c]||""}),a.map((a,d)=>{if(c===f.length-1){if(null===a)return(0,b.jsx)("td",{style:{padding:6,textAlign:"center",borderTop:"1px solid rgba(0,0,0,0.04)"}},`c-${c}-${d}`);let e=3+Math.round(10*Math.min(1,Math.abs(a))),f=a>0?"#ff7043":"#8e44ad";return(0,b.jsx)("td",{style:{padding:6,textAlign:"center",borderTop:"1px solid rgba(0,0,0,0.04)"},children:(0,b.jsx)("div",{title:`alert ${a.toFixed(2)}`,style:{width:e,height:e,borderRadius:"50%",background:f,margin:"0 auto"}})},`c-${c}-${d}`)}let e=!0===a?i:!1===a?j:l;return(0,b.jsx)("td",{style:{padding:4,textAlign:"center",borderTop:"1px solid rgba(0,0,0,0.04)"},children:(0,b.jsx)("div",{style:{width:"10px",height:"10px",margin:"0 auto",borderRadius:4,background:e}})},`c-${c}-${d}`)})]},`r-${c}`))})]})}),c&&(0,b.jsxs)("div",{style:{flex:"0 0 25%",minWidth:160,padding:8,borderLeft:"1px solid rgba(0,0,0,0.04)"},children:[(0,b.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Legend & Notes"}),(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,b.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,b.jsx)("div",{style:{width:14,height:10,background:i,borderRadius:2}}),(0,b.jsx)("div",{style:{fontSize:13},children:"Meets target"})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,b.jsx)("div",{style:{width:14,height:10,background:j,borderRadius:2}}),(0,b.jsx)("div",{style:{fontSize:13},children:"Does not meet target"})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,b.jsx)("div",{style:{width:14,height:10,background:l,borderRadius:2}}),(0,b.jsx)("div",{style:{fontSize:13},children:"No data / unknown"})]}),(0,b.jsx)("div",{style:{height:1,background:"rgba(0,0,0,0.04)",margin:"8px 0"}}),(0,b.jsx)("div",{style:{fontSize:13,fontWeight:600},children:"Evaluation circle"}),(0,b.jsxs)("div",{style:{fontSize:12,color:"#444"},children:["Circle appears when lag and lead progress is mismatched.",(0,b.jsx)("br",{}),"Size varies with the magnitude of the mismatch.",(0,b.jsx)("br",{}),"Color:",(0,b.jsx)("br",{}),"orange - LAG is regressing but LEADs are progressing;",(0,b.jsx)("br",{}),"purple - LAG is progressing but LEADs are regressing."]})]})]})]})}function B({color:a="#000",label:c="",dashed:d=!1,hidden:e=!1,solid:f=!1}){return e?null:(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#333"},children:[(0,b.jsx)("div",{style:{position:"relative",width:18,height:8,background:f||d?"transparent":a,borderTop:d?`2px dashed ${a}`:f?`2px solid ${a}`:"none",top:f||d?4:0}}),(0,b.jsx)("div",{children:c})]})}function C({open:a,a3:d,onClose:e}){let[f,g]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{if(!a)return;let b=a=>{"Escape"===a.key&&e&&e()};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[a,e]),a&&d)?(0,b.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:()=>{e&&e()},children:(0,b.jsxs)("div",{role:"dialog","aria-modal":"true",style:{background:"white",borderRadius:8,width:"90%",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 8px 24px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column"},onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)"},children:[(0,b.jsx)("h3",{style:{margin:0},children:d?.header?.title||d?.header?.id||"A3 Details"}),(0,b.jsx)("div",{style:{display:"flex",gap:8},children:(0,b.jsx)("button",{onClick:()=>{e&&e()},style:{cursor:"pointer",padding:"6px 10px",borderRadius:6,border:"none",background:"var(--cancel)",color:"white"},children:"Close"})})]}),(0,b.jsxs)("div",{style:{padding:12,overflow:"auto"},children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",gap:12},children:(0,b.jsx)("h4",{style:{margin:0},children:(0,b.jsx)("u",{children:"Action Plan Progress"})})}),(0,b.jsx)("div",{style:{flex:1}}),(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,b.jsx)(B,{color:"var(--green)",label:"Progress (%)",solid:!0}),(0,b.jsx)(B,{color:"var(--cancel)",label:"Total Tasks",solid:!0}),(0,b.jsx)(B,{color:"var(--accent)",label:"Prog. Target",dashed:!0})]})]}),(0,b.jsx)("div",{style:{margin:"8px 0 18px 0"},children:(0,b.jsx)(s,{progress:d?.progress||[],height:200,percent:f})}),(0,b.jsx)("h4",{children:(0,b.jsxs)("u",{children:["LAG Measure (",d.metrics?.lag.metricName," (",d.metrics?.lag.unit,"))"]})}),(0,b.jsxs)("div",{style:{margin:"8px 0 18px 0",height:200,display:"flex",flexDirection:"row",gap:12},children:[(0,b.jsx)("div",{style:{flex:"0 0 30%",minWidth:0,height:"100%"},children:(0,b.jsx)(y,{metric:d.metrics?.lag||{},minHeight:200,unit:d.metrics?.lag?.unit||""})}),(0,b.jsx)("div",{style:{flex:"0 0 70%",minWidth:0,height:"100%"},children:(0,b.jsx)(t.default,{metric:d.metrics?.lag||{},showZones:!1,showGrid:!1,targetLine:!0,bgColor:"transparent",minHeight:200,style:{width:"100%",height:"100%"}})})]}),d.metrics?.leads&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h4",{children:(0,b.jsx)("u",{children:"LAG vs LEADS"})}),(0,b.jsx)(A,{a3:d})]})]})]})}):null}var D=a.i(96387);function E(){let{user:a}=(0,h.useUser)(),e=(0,j.useRouter)();(0,c.useEffect)(()=>{a||e.push("/")},[a,e]);let m=a?a.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):"",{a3s:n=[],setA3s:o}=(0,i.useA3s)();(0,c.useEffect)(()=>{Array.isArray(n)&&0!==n.length&&(async()=>{let a=[];for(let b of n)if(b)try{let c=(0,D.ensureLateFlagsForA3)(b);c=(0,D.ensureProgressForA3)(c),JSON.stringify(c)!==JSON.stringify(b)&&(a.push(c),o(a=>{let b=a.findIndex(a=>a?.header?.id===c?.header?.id);if(-1===b)return a;let d=[...a];return d[b]=c,d}))}catch(a){console.warn("Auto-update error for A3",b?.header?.id,a)}0!==a.length&&(await Promise.all(a.map(async a=>{try{let b=await fetch("/api/a3s",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let c=await b.text().catch(()=>"");console.warn("Auto-save failed for",a?.header?.id,b.status,c)}}catch(b){console.warn("Auto-save failed for",a?.header?.id,b)}})),e&&"function"==typeof e.refresh&&e.refresh())})()},[n,o,e]);let[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,z]=(0,c.useState)("all"),[A,B]=(0,c.useState)("all"),[E,F]=(0,c.useState)("all"),[G,H]=(0,c.useState)("id:asc"),I=(n||[]).filter(b=>{if(!b||!b.header)return!1;let c=b.header.owner,d=Array.isArray(b.header.team)?b.header.team:[];return c===a||d.includes(a)}),J=(0,c.useMemo)(()=>{let b=I.slice();"draft"===x?b=b.filter(a=>a?.draft):"published"===x&&(b=b.filter(a=>a?.published)),"owner"===A?b=b.filter(b=>b.header.owner===a):"team"===A&&(b=b.filter(b=>{let c=b.header.owner,d=Array.isArray(b.header.team)?b.header.team:[];return c!==a&&d.includes(a)}));let c=new Date;"upcoming"===E?b=b.filter(a=>(a?.header?.start?new Date(a.header.start):null)>c):"ongoing"===E?b=b.filter(a=>{let b=a?.header?.start?new Date(a.header.start):null,d=a?.header?.end?new Date(a.header.end):null;return b<=c&&d>=c}):"finished"===E?b=b.filter(a=>!!a&&!!a.header&&!!a.header.end&&(a?.header?.end?new Date(a.header.end):null)<c):"none"===E&&(b=b.filter(a=>{let b=a?.header?.start?new Date(a.header.start):null,c=a?.header?.end?new Date(a.header.end):null;return!b&&!c}));let[d,e]=(G||"id:asc").split(":"),f="desc"===e?-1:1,g=a=>{if(!a)return null;let b=new Date(a);return isNaN(b)?null:b};return b.sort((a,b)=>{if("id"===d){let c=String(a?.header?.id||""),d=String(b?.header?.id||"");return c.localeCompare(d)*f}if("title"===d){let c=String(a?.header?.title||"").toLowerCase(),d=String(b?.header?.title||"").toLowerCase();return c.localeCompare(d)*f}if("start"===d||"end"===d){let c=g(a?.header?.start),e=g(b?.header?.start),h="start"===d?c:g(a?.header?.end),i="start"===d?e:g(b?.header?.end);return null===h&&null===i?0:null===h?+f:null===i?-1*f:(h-i)*f}return 0}),b},[I,x,G,A,E,a]),K=async a=>{if(a&&confirm(`Delete A3 ${a}? This operation cannot be undone.`))try{let b=await fetch("/api/a3s",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a})});if(!b.ok){let a=await b.json().catch(()=>null);alert(a?.error||"Failed to delete A3");return}e&&"function"==typeof e.refresh&&e.refresh()}catch(a){console.error("Delete failed",a),alert("Delete failed")}};return a?(0,b.jsxs)("main",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[(0,b.jsx)("div",{style:{height:"5vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsxs)("h1",{style:{margin:0},children:["Welcome, ",(0,b.jsx)("strong",{children:m}),"!"]})}),(0,b.jsxs)("div",{style:{height:"5vh",padding:"0px 16px",display:"flex",alignItems:"center",justifyContent:"center",gap:12,fontSize:12},children:[(0,b.jsxs)("div",{style:{display:"flex",gap:0,alignItems:"center",height:"3vh"},children:[(0,b.jsx)("button",{onClick:()=>z("all"),style:{padding:"0px 10px",borderRadius:"6px 0 0 6px",border:"1px solid rgba(0,0,0,0.06)",background:"all"===x?"var(--gray-dark)":"transparent",color:"all"===x?"white":"inherit",cursor:"pointer"},children:"All"}),(0,b.jsx)("button",{onClick:()=>z("draft"),style:{padding:"0px 10px",borderRadius:"0",border:"1px solid rgba(0,0,0,0.06)",borderLeft:"none",background:"draft"===x?"var(--gray)":"transparent",color:"draft"===x?"white":"inherit",cursor:"pointer"},children:"Draft"}),(0,b.jsx)("button",{onClick:()=>z("published"),style:{padding:"0px 10px",borderRadius:"0 6px 6px 0",border:"1px solid rgba(0,0,0,0.06)",borderLeft:"none",background:"published"===x?"var(--accent)":"transparent",color:"published"===x?"white":"inherit",cursor:"pointer"},children:"Published"})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:0,alignItems:"center",height:"3vh"},children:[(0,b.jsx)("button",{onClick:()=>B("all"),style:{padding:"0px 10px",borderRadius:"6px 0 0 6px",border:"1px solid rgba(0,0,0,0.06)",background:"all"===A?"var(--gray-dark)":"transparent",color:"all"===A?"white":"inherit",cursor:"pointer"},children:"All"}),(0,b.jsx)("button",{onClick:()=>B("owner"),style:{padding:"0px 10px",borderRadius:"0",border:"1px solid rgba(0,0,0,0.06)",borderLeft:"none",background:"owner"===A?"var(--main)":"transparent",color:"owner"===A?"white":"inherit",cursor:"pointer"},children:"Owner"}),(0,b.jsx)("button",{onClick:()=>B("team"),style:{padding:"0px 10px",borderRadius:"0 6px 6px 0",border:"1px solid rgba(0,0,0,0.06)",borderLeft:"none",background:"team"===A?"var(--cancel)":"transparent",color:"team"===A?"white":"inherit",cursor:"pointer"},children:"Team Member"})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:0,alignItems:"center",height:"3vh"},children:[(0,b.jsx)("button",{onClick:()=>F("all"),style:{padding:"0px 10px",borderRadius:"6px 0 0 6px",border:"1px solid rgba(0,0,0,0.06)",background:"all"===E?"var(--gray-dark)":"transparent",color:"all"===E?"white":"inherit",cursor:"pointer"},children:"All"}),(0,b.jsx)("button",{onClick:()=>F("upcoming"),style:{padding:"0px 10px",borderRadius:"0",border:"1px solid rgba(0,0,0,0.06)",borderLeft:"none",background:"upcoming"===E?"var(--orange)":"transparent",color:"upcoming"===E?"white":"inherit",cursor:"pointer"},children:"Upcoming"}),(0,b.jsx)("button",{onClick:()=>F("ongoing"),style:{padding:"0px 10px",borderRadius:"0",border:"1px solid rgba(0,0,0,0.06)",borderLeft:"none",background:"ongoing"===E?"var(--green)":"transparent",color:"ongoing"===E?"white":"inherit",cursor:"pointer"},children:"Ongoing"}),(0,b.jsx)("button",{onClick:()=>F("finished"),style:{padding:"0px 10px",borderRadius:"0",border:"1px solid rgba(0,0,0,0.06)",borderLeft:"none",background:"finished"===E?"var(--blue)":"transparent",color:"finished"===E?"white":"inherit",cursor:"pointer"},children:"Finished"}),(0,b.jsx)("button",{onClick:()=>F("none"),style:{padding:"0px 10px",borderRadius:"0 6px 6px 0",border:"1px solid rgba(0,0,0,0.06)",borderLeft:"none",background:"none"===E?"var(--gray-dark)":"transparent",color:"none"===E?"white":"inherit",cursor:"pointer"},children:"None"})]}),(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,b.jsx)("label",{style:{fontSize:12,color:"var(--gray-dark)"},children:"Sort"}),(0,b.jsxs)("select",{value:G,onChange:a=>H(a.target.value),style:{borderRadius:6,border:"1px solid rgba(0,0,0,0.1)",padding:"4px 8px"},children:[(0,b.jsx)("option",{value:"id:asc",children:"ID (asc)"}),(0,b.jsx)("option",{value:"id:desc",children:"ID (desc)"}),(0,b.jsx)("option",{value:"title:asc",children:"Title (asc)"}),(0,b.jsx)("option",{value:"title:desc",children:"Title (desc)"}),(0,b.jsx)("option",{value:"start:asc",children:"Start (asc)"}),(0,b.jsx)("option",{value:"start:desc",children:"Start (desc)"}),(0,b.jsx)("option",{value:"end:asc",children:"End (asc)"}),(0,b.jsx)("option",{value:"end:desc",children:"End (desc)"})]})]})]}),(0,b.jsx)("div",{style:{height:"90vh",padding:16,overflow:"auto"},children:(0,b.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{style:{borderBottom:"1px solid rgba(0,0,0,0.08)"},children:[(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"2.5%",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.08)"},children:"ID"}),(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"2.5%",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.08)"},children:"Ver."}),(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"10%",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.08)"},children:"Title"}),(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"10%",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.08)"},children:"Time span"}),(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"5%",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.08)"},children:"Owner"}),(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"20%",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.08)"},children:"Team"}),(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"15%",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.08)"},children:"Tags"}),(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"10%",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.08)"},children:"Actions"}),(0,b.jsx)("th",{className:"cell-scroll",style:{padding:"8px",width:"15%",textAlign:"center"},children:"Detail (Click to Expand)"})]})}),(0,b.jsxs)("tbody",{children:[J.map(c=>{let h=c?.header?.id||"",i=String(h).split("-"),j=i[1]||"",l=i[2]||"",m=c?.header?.owner,n=Array.isArray(c?.header?.team)?c.header.team:[],o=m===a,p=!o&&n.includes(a),r=c?.header?.start,t=c?.header?.end,v=c?.header?.lastUpdated,x=c?.metrics?.lag,z=a=>{if(!a)return null;let b=new Date(a);return isNaN(b)?null:b},A=a=>{let b=z(a);if(!b)return"";let c=String(b.getDate()).padStart(2,"0"),d=String(b.getMonth()+1).padStart(2,"0"),e=String(b.getFullYear()).slice(-2);return`${c}/${d}/${e}`},B=z(r),C=z(t);A(z(v));let D=new Date,E=a=>a?new Date(a.getFullYear(),a.getMonth(),a.getDate()):null,F=E(D),G=E(B),H=E(C),I="-";if(B||C){let a=B?A(B):"—",b=C?A(C):"—";I=`${a} to ${b}`}let J=null;return(G||H)&&(G&&H?J=F>=G&&F<=H?"Ongoing":F<G?"Upcoming":"Finished":G&&!H?J=F>=G?"Ongoing":"Upcoming":!G&&H&&(J=F<=H?"Ongoing":"Finished")),(0,b.jsxs)("tr",{style:{borderBottom:"1px solid rgba(0,0,0,0.04)"},children:[(0,b.jsx)("td",{className:"cell-scroll",style:{padding:"8px",verticalAlign:"middle",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.04)"},children:j}),(0,b.jsx)("td",{className:"cell-scroll",style:{padding:"8px",verticalAlign:"middle",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.04)"},children:l}),(0,b.jsx)("td",{className:"cell-scroll",style:{padding:"8px",verticalAlign:"middle",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.04)"},children:c?.header?.title||"(untitled)"}),(0,b.jsx)("td",{className:"cell-scroll",style:{padding:"8px",verticalAlign:"middle",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.04)"},children:I}),(0,b.jsx)("td",{className:"cell-scroll",style:{padding:"8px",verticalAlign:"middle",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.04)"},children:(0,k.toInitialLast)(m)}),(0,b.jsx)("td",{className:"cell-scroll",style:{padding:"8px",verticalAlign:"middle",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.04)"},children:((a=[],b)=>a&&0!==a.length?(a||[]).filter(a=>a!==b).map(k.toInitialLast).join(", "):"-")(n,m)}),(0,b.jsx)("td",{className:"cell-scroll",style:{padding:"8px",verticalAlign:"middle",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.04)"},children:(0,b.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"center",flexWrap:"wrap"},children:(()=>{let a=[];return c?.published?a.push({key:"published",text:"Published",bg:"var(--accent)"}):c?.draft&&a.push({key:"draft",text:"Draft",bg:"var(--gray)"}),o?a.push({key:"owner",text:"Owner",bg:"var(--main)"}):p&&a.push({key:"team",text:"Team Member",bg:"var(--cancel)"}),J&&a.push({key:`schedule:${J}`,text:J,bg:"Ongoing"===J?"var(--green)":"Upcoming"===J?"var(--orange)":"var(--blue)"}),a.slice(0,3).map(a=>(0,b.jsx)("span",{style:{background:a.bg,color:"white",padding:"4px 8px",borderRadius:12},children:a.text},a.key))})()})}),(0,b.jsx)("td",{style:{padding:"8px",verticalAlign:"middle",textAlign:"center",borderRight:"1px solid rgba(0,0,0,0.04)"},children:(0,b.jsx)("div",{style:{width:"100%",padding:2},children:(0,b.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"center"},children:[(0,b.jsx)("button",{title:"Edit A3",onClick:()=>e.push(`/a3/${encodeURIComponent(h)}/edit`),style:{flex:"1 1 0",maxWidth:"20%",aspectRatio:"1 / 1",borderRadius:"50%",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--main)",color:"white",cursor:"pointer",padding:0},"aria-label":"Edit",children:(0,b.jsx)(d.MdOutlineEdit,{size:15})}),(0,b.jsx)("button",{title:"View",onClick:()=>e.push(`/a3/${encodeURIComponent(h)}/view`),style:{flex:"1 1 0",maxWidth:"20%",aspectRatio:"1 / 1",borderRadius:"50%",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--orange)",color:"white",cursor:"pointer",padding:0},"aria-label":"View A3",children:(0,b.jsx)(f,{size:15})}),(0,b.jsx)("button",{title:"Download (A3 sheet)",onClick:()=>{s(c),q(!0)},style:{flex:"1 1 0",maxWidth:"20%",aspectRatio:"1 / 1",borderRadius:"50%",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--green)",color:"white",cursor:"pointer",padding:0},"aria-label":"Download",children:(0,b.jsx)(g.FaDownload,{size:11})}),(0,b.jsx)("button",{title:"Delete A3",onClick:()=>K(h),style:{flex:"1 1 0",maxWidth:"20%",aspectRatio:"1 / 1",borderRadius:"50%",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--cancel)",color:"white",cursor:"pointer",padding:0},"aria-label":"Delete",children:(0,b.jsx)(d.MdDelete,{size:15})})]})})}),(0,b.jsx)("td",{className:"cell-scroll",style:{padding:"8px",verticalAlign:"middle",textAlign:"center"},onClick:()=>{w(c),u(!0)},children:(0,b.jsx)("div",{style:{width:"100%",height:"100%"},children:(0,b.jsx)(y,{metric:x,unit:x?.unit})})})]},h)}),0===J.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,style:{padding:16,color:"#666"},children:"No A3s to show"})})]})]})}),p&&(0,b.jsx)(l.default,{a3:r,format:"A3",onFinish:()=>{q(!1),s(null)}}),(0,b.jsx)(C,{open:t,a3:v,onClose:()=>{u(!1),w(null)}})]}):null}}];

//# sourceMappingURL=src_app_home_page_3de3301a.js.map