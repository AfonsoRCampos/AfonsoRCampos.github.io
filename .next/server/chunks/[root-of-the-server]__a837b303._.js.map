{"version":3,"sources":["turbopack:///[project]/src/pages/api/a3s.js","turbopack:///[project]/node_modules/next/dist/esm/build/templates/pages-api.js"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nexport default function handler(req, res) {\r\n  const filePath = path.join(process.cwd(), 'src', 'data', 'A3s.json');\r\n\r\n  if (req.method === 'GET') {\r\n    const fileContents = fs.readFileSync(filePath, 'utf8');\r\n    const A3s = JSON.parse(fileContents);\r\n    return res.status(200).json(A3s);\r\n  }\r\n\r\n  if (req.method === 'POST') {\r\n    const newA3 = req.body;\r\n    const fileContents = fs.readFileSync(filePath, 'utf8');\r\n    const A3s = JSON.parse(fileContents);\r\n\r\n    // helper: generate next A3 id like A3-001-A\r\n    function makeNextA3Id(list) {\r\n      if (!Array.isArray(list) || list.length === 0) return 'A3-001-A';\r\n      const numbers = list\r\n        .map(a3 => {\r\n          const id = a3?.header?.id || '';\r\n          const m = id.split('-')[1];\r\n          return m ? parseInt(m, 10) : 0;\r\n        })\r\n        .filter(n => n > 0);\r\n      const maxNum = numbers.length ? Math.max(...numbers) : 0;\r\n      const nextNum = (maxNum + 1).toString().padStart(3, '0');\r\n      return `A3-${nextNum}-A`;\r\n    }\r\n\r\n    if (!newA3.header.id) {\r\n      newA3.header.id = makeNextA3Id(A3s);\r\n    }\r\n\r\n    // look for existing entry by series id (the middle part of header.id)\r\n    const seriesId = (newA3?.header?.id || '').split('-')[1];\r\n    const idx = A3s.findIndex(A3 => (A3?.header?.id || '').split('-')[1] === seriesId);\r\n    const existing = idx !== -1 ? A3s[idx] : null;\r\n\r\n    if (existing && existing.published) return res.status(409).json({ error: 'A3 id already exists.' });\r\n    else if (existing && existing.draft) {\r\n      A3s[idx] = newA3;\r\n      fs.writeFileSync(filePath, JSON.stringify(A3s, null, 2), 'utf8');\r\n    } else {\r\n      A3s.push(newA3);\r\n    }\r\n\r\n    try {\r\n      const srcId = newA3?.header?.id;\r\n      const refs = Array.isArray(newA3.header?.refs) ? newA3.header.refs : [];\r\n      for (const t of refs) {\r\n        const ti = A3s.findIndex(a => a && a.header && a.header.id === t);\r\n        if (ti !== -1) {\r\n          A3s[ti].header.refBy = Array.isArray(A3s[ti].header.refBy) ? A3s[ti].header.refBy : [];\r\n          if (!A3s[ti].header.refBy.includes(srcId)) A3s[ti].header.refBy.push(srcId);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to reconcile refs on create', e);\r\n    }\r\n\r\n    fs.writeFileSync(filePath, JSON.stringify(A3s, null, 2), 'utf8');\r\n\r\n    // Also create the initial version snapshot (version A) in central versions file\r\n    if (newA3.published) {\r\n      try {\r\n        const versionsPath = path.join(process.cwd(), 'src', 'data', 'A3Versions.json');\r\n        let versions = {};\r\n        if (fs.existsSync(versionsPath)) {\r\n          const raw = fs.readFileSync(versionsPath, 'utf8') || '{}';\r\n          versions = JSON.parse(raw);\r\n        }\r\n        // ensure series entry exists\r\n        const series = (newA3.header && String(newA3.header.id || '').split('-')[1]) || null;\r\n        if (!series) throw new Error('Invalid A3 header id for versioning');\r\n        versions[series] = versions[series] || {};\r\n\r\n        // determine next version label (use 'A' when no existing versions)\r\n        function nextVersionLabel(label) {\r\n          if (!label) return 'A';\r\n          const base = 26;\r\n          const letters = label.toUpperCase().split('');\r\n          let digits = letters.map(ch => ch.charCodeAt(0) - 65);\r\n          for (let i = digits.length - 1; i >= 0; i--) {\r\n            digits[i] += 1;\r\n            if (digits[i] < base) {\r\n              return digits.map(d => String.fromCharCode(65 + d)).join('');\r\n            }\r\n            digits[i] = 0;\r\n            if (i === 0) {\r\n              digits = [0].concat(digits);\r\n              return digits.map(d => String.fromCharCode(65 + d)).join('');\r\n            }\r\n          }\r\n          return 'A';\r\n        }\r\n\r\n        function labelToNumber(label) {\r\n          if (!label) return 0;\r\n          const letters = label.toUpperCase().split('');\r\n          let value = 0;\r\n          for (let i = 0; i < letters.length; i++) {\r\n            value = value * 26 + (letters[i].charCodeAt(0) - 64);\r\n          }\r\n          return value;\r\n        }\r\n\r\n        const existingLabels = Object.keys(versions[series] || {});\r\n        let initialLabel = 'A';\r\n        if (existingLabels.length > 0) {\r\n          const last = existingLabels.sort((a, b) => labelToNumber(a) - labelToNumber(b))[existingLabels.length - 1];\r\n          initialLabel = nextVersionLabel(last);\r\n        }\r\n\r\n        // compute the updated id for the A3 (set version label to initialLabel)\r\n        let newId = newA3.header.id;\r\n        try {\r\n          const parts = String(newA3.header.id || '').split('-');\r\n          if (parts.length >= 3) {\r\n            parts[2] = initialLabel;\r\n            newId = parts.join('-');\r\n          }\r\n        } catch (e) { /* ignore - keep existing id */ }\r\n\r\n        // persist version snapshot using the (updated) snapshot id\r\n        const snapshot = { ...newA3, header: { ...(newA3.header || {}), id: newId } };\r\n        versions[series][initialLabel] = { snapshot, meta: { ts: Date.now(), message: 'A3 Published.' } };\r\n        fs.writeFileSync(versionsPath, JSON.stringify(versions, null, 2), 'utf8');\r\n\r\n        // Update stored A3s list to reflect the bumped id and reconcile cross-references\r\n        try {\r\n          // find the entry in the in-memory A3s array (we already mutated A3s above)\r\n          const idx2 = A3s.findIndex(a => a && a.header && String(a.header.id || '').split('-')[1] === series);\r\n          if (idx2 !== -1) {\r\n            const oldId = A3s[idx2].header.id;\r\n            A3s[idx2].header.id = newId;\r\n\r\n            // Update other A3s: replace refs/refBy occurrences of oldId with newId\r\n            for (let i = 0; i < A3s.length; i++) {\r\n              if (!A3s[i] || !A3s[i].header) continue;\r\n              if (i === idx2) continue;\r\n              if (Array.isArray(A3s[i].header.refs)) {\r\n                let changed = false;\r\n                A3s[i].header.refs = A3s[i].header.refs.map(r => {\r\n                  if (r === oldId) { changed = true; return newId; }\r\n                  return r;\r\n                });\r\n                if (changed) {\r\n                  A3s[i].header.refs = Array.from(new Set(A3s[i].header.refs));\r\n                }\r\n              }\r\n              if (Array.isArray(A3s[i].header.refBy)) {\r\n                let changed = false;\r\n                A3s[i].header.refBy = A3s[i].header.refBy.map(r => {\r\n                  if (r === oldId) { changed = true; return newId; }\r\n                  return r;\r\n                });\r\n                if (changed) {\r\n                  A3s[i].header.refBy = Array.from(new Set(A3s[i].header.refBy));\r\n                }\r\n              }\r\n            }\r\n\r\n            // write the updated A3s.json back to disk so stored A3 id matches published version\r\n            fs.writeFileSync(filePath, JSON.stringify(A3s, null, 2), 'utf8');\r\n\r\n            // reflect id change in the object we return to the client\r\n            newA3.header.id = newId;\r\n          }\r\n        } catch (e) {\r\n          console.error('Failed to update A3s ids after publishing', e);\r\n        }\r\n      } catch (e) {\r\n        // non-fatal: continue but log\r\n        console.error('Failed to write initial version snapshot or update ids', e);\r\n      }\r\n    }\r\n    return res.status(201).json(newA3);\r\n  }\r\n\r\n  // Upsert / save edits to an existing A3 (by series id)\r\n  if (req.method === 'PUT') {\r\n    const updatedA3 = req.body;\r\n    if (!updatedA3 || !updatedA3.header || !updatedA3.header.id) return res.status(400).json({ error: 'Invalid A3 payload' });\r\n    const series = updatedA3.header.id.split('-')[1];\r\n    const fileContents = fs.readFileSync(filePath, 'utf8');\r\n    const A3s = JSON.parse(fileContents);\r\n    const idx = A3s.findIndex(A3 => A3.header.id.split('-')[1] === series);\r\n    if (idx === -1) {\r\n      A3s.push(updatedA3);\r\n      try {\r\n        const srcId = updatedA3.header.id;\r\n        const refs = Array.isArray(updatedA3.header.refs) ? updatedA3.header.refs : [];\r\n        for (const t of refs) {\r\n          const ti = A3s.findIndex(a => a && a.header && a.header.id === t);\r\n          if (ti !== -1) {\r\n            A3s[ti].header.refBy = Array.isArray(A3s[ti].header.refBy) ? A3s[ti].header.refBy : [];\r\n            if (!A3s[ti].header.refBy.includes(srcId)) A3s[ti].header.refBy.push(srcId);\r\n          }\r\n        }\r\n      } catch (e) { console.error('Failed to reconcile refs on upsert-new', e); }\r\n    } else {\r\n      const prev = A3s[idx];\r\n      A3s[idx] = updatedA3;\r\n      try {\r\n        const srcId = updatedA3.header.id;\r\n        const prevRefs = Array.isArray(prev.header?.refs) ? prev.header.refs : [];\r\n        const newRefs = Array.isArray(updatedA3.header?.refs) ? updatedA3.header.refs : [];\r\n        const added = newRefs.filter(x => !prevRefs.includes(x));\r\n        const removed = prevRefs.filter(x => !newRefs.includes(x));\r\n        for (const t of added) {\r\n          const ti = A3s.findIndex(a => a && a.header && a.header.id === t);\r\n          if (ti !== -1) {\r\n            A3s[ti].header.refBy = Array.isArray(A3s[ti].header.refBy) ? A3s[ti].header.refBy : [];\r\n            if (!A3s[ti].header.refBy.includes(srcId)) A3s[ti].header.refBy.push(srcId);\r\n          }\r\n        }\r\n        for (const t of removed) {\r\n          const ti = A3s.findIndex(a => a && a.header && a.header.id === t);\r\n          if (ti !== -1 && Array.isArray(A3s[ti].header.refBy)) {\r\n            A3s[ti].header.refBy = A3s[ti].header.refBy.filter(x => x !== srcId);\r\n          }\r\n        }\r\n      } catch (e) { console.error('Failed to reconcile refs on update', e); }\r\n    }\r\n    fs.writeFileSync(filePath, JSON.stringify(A3s, null, 2), 'utf8');\r\n    return res.status(200).json(updatedA3);\r\n  }\r\n\r\n  // Delete a single A3 by full header.id\r\n  if (req.method === 'DELETE') {\r\n    const payload = req.body || {};\r\n    const idToDelete = payload.id || (req.query && req.query.id);\r\n    if (!idToDelete) return res.status(400).json({ error: 'Missing id to delete' });\r\n\r\n    const fileContentsDel = fs.readFileSync(filePath, 'utf8');\r\n    let A3sDel = JSON.parse(fileContentsDel || '[]');\r\n    const idxDel = A3sDel.findIndex(A3 => A3 && A3.header && A3.header.id === idToDelete);\r\n    if (idxDel === -1) return res.status(404).json({ error: 'A3 not found' });\r\n\r\n    // remove from list\r\n    const removed = A3sDel.splice(idxDel, 1)[0];\r\n\r\n    // Clean up any cross-references in remaining A3s (remove this id from their refs and refBy)\r\n    try {\r\n      for (let i = 0; i < A3sDel.length; i++) {\r\n        const a = A3sDel[i];\r\n        if (!a || !a.header) continue;\r\n        if (Array.isArray(a.header.refs)) {\r\n          const before = a.header.refs.length;\r\n          a.header.refs = a.header.refs.filter(x => x !== idToDelete);\r\n          // if changed, keep the new array\r\n        }\r\n        if (Array.isArray(a.header.refBy)) {\r\n          const before = a.header.refBy.length;\r\n          a.header.refBy = a.header.refBy.filter(x => x !== idToDelete);\r\n        }\r\n      }\r\n\r\n      fs.writeFileSync(filePath, JSON.stringify(A3sDel, null, 2), 'utf8');\r\n    } catch (e) {\r\n      console.error('Failed to write A3s.json on delete (cleanup)', e);\r\n      return res.status(500).json({ error: 'Failed to delete A3' });\r\n    }\r\n\r\n    // Also remove any versions snapshot for the series (best-effort, non-fatal)\r\n    try {\r\n      const versionsPath = path.join(process.cwd(), 'src', 'data', 'A3Versions.json');\r\n      if (fs.existsSync(versionsPath)) {\r\n        const raw = fs.readFileSync(versionsPath, 'utf8') || '{}';\r\n        const versions = JSON.parse(raw);\r\n        const series = (removed && removed.header && removed.header.id) ? removed.header.id.split('-')[1] : null;\r\n        if (series && versions[series]) {\r\n          delete versions[series];\r\n          fs.writeFileSync(versionsPath, JSON.stringify(versions, null, 2), 'utf8');\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // log and continue â€” deletion of versions is non-fatal\r\n      console.error('Failed to remove A3Versions entry on delete', e);\r\n    }\r\n\r\n    return res.status(200).json({ deleted: idToDelete });\r\n  }\r\n\r\n  res.status(405).json({ error: 'Method not allowed' });\r\n}\r\n","import { sendError } from \"next/dist/esm/server/api-utils\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { PagesAPIRouteModule } from \"next/dist/esm/server/route-modules/pages-api/module.compiled\";\nimport { hoist } from \"next/dist/esm/build/templates/helpers\";\n// Import the userland code.\nimport * as userland from \"INNER_PAGE\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\n// Re-export the handler (should be the default export).\nexport default hoist(userland, 'default');\n// Re-export config.\nexport const config = hoist(userland, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new PagesAPIRouteModule({\n    definition: {\n        kind: RouteKind.PAGES_API,\n        page: \"/api/a3s\",\n        pathname: \"/api/a3s\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland,\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || ''\n});\nexport async function handler(req, res, ctx) {\n    let srcPage = \"/api/a3s\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    }\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = getTracer();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: process.env.__NEXT_ALLOWED_REVALIDATE_HEADERS,\n                multiZoneDraftMode: Boolean(process.env.__NEXT_MULTI_ZONE_DRAFT_MODE),\n                trustHostHeader: process.env.__NEXT_TRUST_HOST_HEADER,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/a3s\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        sendError(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n"],"names":[],"mappings":"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","ignoreList":[1]}