(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70593,e=>{"use strict";e.s(["default",()=>l]);var t=e.i(43476),a=e.i(71645);function l(e){let{id:l,value:i,onChange:r,width:n="100%",height:s="2.5em",borderColor:u="var(--main)",bgColor:d="white",hoverColor:o="white",style:c={},placeholder:h="Enter text...",min:g,max:v,...m}=e,[f,y]=a.default.useState(!1),p=m.options,b={width:n,height:s,border:"1px solid ".concat(u),background:f?o:d,borderRadius:"6px",padding:"0.25em 0.75em",fontSize:"1em",transition:"background 0.2s, border-color 0.2s",boxSizing:"border-box",color:"black",...c};return p&&Array.isArray(p)?(0,t.jsx)("select",{id:l,value:i,onChange:r,style:b,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),...m,placeholder:h,children:p.map((e,a)=>{var l;if("string"==typeof e)return(0,t.jsx)("option",{value:e,children:e},a);let i=!!e.disabled,r=e.title||void 0;return(0,t.jsx)("option",{value:e.value,disabled:i,title:r,children:null!=(l=e.label)?l:e.value},a)})}):(0,t.jsx)("input",{id:l,type:m.type||"text",value:i,onChange:e=>{if(r){if(("number"===m.type||"numeric"===m.inputMode||"decimal"===m.inputMode)&&(void 0!==g||void 0!==v)){var t,a;let l=null!=(a=null==e||null==(t=e.target)?void 0:t.value)?a:"";if(""===l)return void r({target:{value:""}});let i=parseFloat(l);if(Number.isNaN(i))return void r(e);let n=i;return void 0!==g&&(n=Math.max(Number(g),n)),void 0!==v&&(n=Math.min(Number(v),n)),void(n!==i?r({target:{value:String(n)}}):r(e))}r(e)}},placeholder:h,style:b,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),min:g,max:v,...m})}},4251,e=>{"use strict";e.s(["default",()=>v]);var t=e.i(43476),a=e.i(71645),l=e.i(50341),i=e.i(45889),r=e.i(18955),n=e.i(95273),s=e.i(48563),u=e.i(68788),d=e.i(72369),o=e.i(95384),c=e.i(74846),h=e.i(18566),g=e.i(84828);function v(){let{user:e}=(0,r.useUser)(),{a3s:v,setA3s:m}=(0,n.useA3s)(),f={published:!1,draft:!0,header:{id:"",title:"",owner:e,team:[e],lastUpdated:new Date().toISOString(),by:e,start:null,end:null,refBy:[],refs:[]},probDef:{why:"",where:"",extra:"",canEdit:[e]},currentState:{nodes:[],edges:[],canEdit:[e]},actionPlan:{nodes:[],edges:[],canEdit:[e]},actionsSettings:{weighted:!1},actions:[],layout:{sections:{plan1:20,plan2:60,futureState:0,do1:70,checkAct:30},includeFutureState:!1,canEdit:[e],extraCurrentState:{enabled:!1,text:[]},extraCheckAct:{enabled:!1,text:[]}},metrics:{lag:{metricName:"",unit:"",initial:null,target:{type:""},data:[],placeholder:{initial:"",target:"",up:null},display:{enabled:!0,graphType:"simple",showOverlay:!0,showGrid:!1,freq:"monthly"}},leads:[],canEditObjectives:[e],canEditMetrics:[e]},progress:[]},[y,p]=(0,a.useState)(f),[b,x]=(0,a.useState)(null),[w,S]=(0,s.default)(),[A,j]=(0,s.default)(),[k,N]=(0,s.default)(),[P,C]=(0,a.useState)(!1),[O,I]=(0,a.useState)(!1),E=a.default.useRef(null),F=(0,h.useRouter)();(0,a.useEffect)(()=>{var e,t,a,l,i,r,n,s,d,o,c;let h=null==y||null==(e=y.header)?void 0:e.start,g=null==y||null==(t=y.header)?void 0:t.end;if(!h||!g||!(null==y?void 0:y.metrics))return;let v=e=>{let t={daily:0,weekly:1,monthly:2},a={days:0,weeks:1,months:2},l=(e,l)=>{var i,r;return!l||(null!=(i=t[e])?i:0)>=(null!=(r=a[l])?r:0)};return l("daily",e)&&!(0,u.shouldDisableFrequency)(h,g,"daily",100)?"daily":l("weekly",e)&&!(0,u.shouldDisableFrequency)(h,g,"weekly",100)?"weekly":l("monthly",e)&&!(0,u.shouldDisableFrequency)(h,g,"monthly",100)?"monthly":null},m=!1,f="function"==typeof structuredClone?structuredClone(y):JSON.parse(JSON.stringify(y));f.metrics=f.metrics||{};let b=f.metrics.lag||{},x=Array.isArray(b.data)?b.data:[];if(x&&0!==x.length)try{let e=f.metrics.lag.data[0]||{},t=void 0===e.value?null:e.value,a=void 0!==(null==(s=f.metrics.lag)?void 0:s.initial)?f.metrics.lag.initial:null,l=null!==t&&""!==t&&Number.isFinite(Number(t))?Number(t):null,i=null!==a&&""!==a&&Number.isFinite(Number(a))?Number(a):null;l!==i&&(f.metrics.lag.data[0]={...f.metrics.lag.data[0]||{},value:i},m=!0)}catch(e){}else{let e=(null==(l=f.metrics.lag)||null==(a=l.target)?void 0:a.granularity)||null,t=(null==(r=f.metrics.lag)||null==(i=r.display)?void 0:i.freq)||v(e);if(t){let e=(0,u.generateBuckets)(h,g,t),a=void 0!==(null==(n=f.metrics.lag)?void 0:n.initial)?f.metrics.lag.initial:null;f.metrics.lag={...f.metrics.lag||{},data:e.map((e,t)=>({date:e,value:0===t&&null!==a&&""!==a?a:null})),display:{...f.metrics.lag.display||{},freq:t}},m=!0}}f.metrics.leads=f.metrics.leads||[];for(let e=0;e<f.metrics.leads.length;e++){let t=f.metrics.leads[e]||{},a=Array.isArray(t.data)?t.data:[];if(a&&0!==a.length)try{let t=f.metrics.leads[e].data[0]||{},a=void 0===t.value?null:t.value,l=void 0!==(null==(c=f.metrics.leads[e])?void 0:c.initial)?f.metrics.leads[e].initial:null,i=null!==a&&""!==a&&Number.isFinite(Number(a))?Number(a):null,r=null!==l&&""!==l&&Number.isFinite(Number(l))?Number(l):null;i!==r&&(f.metrics.leads[e].data[0]={...f.metrics.leads[e].data[0]||{},value:r},m=!0)}catch(e){}else{let a=(null==t||null==(d=t.target)?void 0:d.granularity)||null,l=(null==(o=t.display)?void 0:o.freq)||v(a);if(l){let a=(0,u.generateBuckets)(h,g,l),i=void 0!==(null==t?void 0:t.initial)?t.initial:null;f.metrics.leads[e]={...f.metrics.leads[e]||{},data:a.map((e,t)=>({date:e,value:0===t&&null!==i&&""!==i?Number(i):null})),display:{...f.metrics.leads[e].display||{},freq:l}},m=!0}}}m&&p(f)},[y,p]);let D=async()=>{try{I(!0);let e="function"==typeof structuredClone?structuredClone(y):JSON.parse(JSON.stringify(y));e.draft=!0,e.published=!1,e.header=e.header||{},e.header.lastUpdated=new Date().toISOString();let t=await fetch("/api/a3s",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();console.error("Failed to save draft",t.status,e);return}let a=await t.json()||e;p(a);try{if("function"==typeof m){let e=await fetch("/api/a3s");if(e.ok){let t=await e.json();m(Array.isArray(t)?t:[])}else m(e=>{let t=Array.isArray(e)?e.slice():[],l=t.findIndex(e=>{var t,l;return(null==e||null==(t=e.header)?void 0:t.id)===(null==a||null==(l=a.header)?void 0:l.id)});return l>=0?t[l]=a:t.push(a),t})}}catch(e){console.warn("Could not refresh global A3 list",e)}F.push("/home")}catch(e){console.error("Error saving draft",e),F.push("/home")}finally{I(!1)}},M={height:"5vh",alignItems:"center",justifyContent:"center",display:"flex",border:"none",borderRadius:6,cursor:"pointer",color:"white",fontWeight:"bold"};return(0,t.jsxs)("div",{style:{width:"100vw",minHeight:"100vh",padding:"1em",boxSizing:"border-box",justifySelf:"center",alignItems:"center",display:"flex",flexDirection:"column",background:"#f0f0f0",gap:"6px"},children:[(0,t.jsx)(i.default,{a3:y,setA3:p,activeArea:b,setActiveArea:x,boundsPreview:N,refPlan2:w,boundsPlan2:S,refPlan4:A,boundsPlan4:j}),(0,t.jsx)(c.default,{a3:y,setA3:p,activeArea:{0:"header",1:"probDef",2:"currentState",3:"objectives",4:"actionPlan",5:null,6:"metrics"}[b],setShowLayout:C,width:N.width,color:b?[["var(--blue-highlight)","var(--blue-highlight)",,"var(--blue)"],["var(--accent-highlight)","var(--accent-highlight)","var(--accent)"],["white","var(--accent-highlight)","var(--accent)"],["var(--accent-highlight)","var(--accent-highlight)","var(--accent)"],["white","var(--accent-highlight)","var(--accent)"],["var(--green-highlight)","var(--green-highlight)","var(--green)"],["var(--orange-highlight)","var(--orange-highlight)","var(--orange)"]][b][2]:void 0}),(0,t.jsx)(l.default,{a3:y,setA3:p,activeArea:b,setActiveArea:x,refPlan2:w,boundsPlan2:S,refPlan4:A,boundsPlan4:j,refPreview:k,boundsPreview:N,showLayout:P,setShowLayout:C,toggleImgSelectorCurrent:()=>{imagePickerTarget.current="currentState",setImagePickerOpen(!0)},toggleImgSelectorActionPlan:()=>{imagePickerTarget.current="actionPlan",setImagePickerOpen(!0)},editable:!0,owner:!0}),(0,t.jsxs)("div",{style:{width:N.width,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,t.jsx)("button",{ref:E,onClick:()=>C(e=>!e),"aria-expanded":P,"aria-label":"Layout settings",style:{...M,aspectRatio:"1/1",backgroundColor:"var(--main-highlight)"},children:(0,t.jsx)(g.FaGear,{})}),(0,t.jsx)(d.default,{a3:y,setA3:p,open:P,onClose:()=>C(!1),anchorRef:E})]}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,t.jsx)(o.default,{a3:y,setA3:p,style:{...M,padding:"6px",backgroundColor:"var(--main)"}}),(0,t.jsx)("button",{onClick:D,disabled:O,style:{...M,backgroundColor:"var(--main-highlight)",padding:"6px"},children:O?"Savingâ€¦":"Save Draft"})]})]})]})}},70653,e=>{e.v(t=>Promise.all(["static/chunks/3b0e68bb28d244be.js"].map(t=>e.l(t))).then(()=>t(24154)))},28471,e=>{e.v(t=>Promise.all(["static/chunks/9fd74ab7f5b98773.js"].map(t=>e.l(t))).then(()=>t(99938)))}]);