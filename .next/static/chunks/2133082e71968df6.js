(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70593,e=>{"use strict";e.s(["default",()=>l]);var t=e.i(43476),a=e.i(71645);function l(e){let{id:l,value:r,onChange:i,width:n="100%",height:s="2.5em",borderColor:o="var(--main)",bgColor:u="white",hoverColor:d="white",style:c={},placeholder:h="Enter text...",min:g,max:v,...f}=e,[m,y]=a.default.useState(!1),p=f.options,b={width:n,height:s,border:"1px solid ".concat(o),background:m?d:u,borderRadius:"6px",padding:"0.25em 0.75em",fontSize:"1em",transition:"background 0.2s, border-color 0.2s",boxSizing:"border-box",color:"black",...c};return p&&Array.isArray(p)?(0,t.jsx)("select",{id:l,value:r,onChange:i,style:b,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),...f,placeholder:h,children:p.map((e,a)=>{var l;if("string"==typeof e)return(0,t.jsx)("option",{value:e,children:e},a);let r=!!e.disabled,i=e.title||void 0;return(0,t.jsx)("option",{value:e.value,disabled:r,title:i,children:null!=(l=e.label)?l:e.value},a)})}):(0,t.jsx)("input",{id:l,type:f.type||"text",value:r,onChange:e=>{if(i){if(("number"===f.type||"numeric"===f.inputMode||"decimal"===f.inputMode)&&(void 0!==g||void 0!==v)){var t,a;let l=null!=(a=null==e||null==(t=e.target)?void 0:t.value)?a:"";if(""===l)return void i({target:{value:""}});let r=parseFloat(l);if(Number.isNaN(r))return void i(e);let n=r;return void 0!==g&&(n=Math.max(Number(g),n)),void 0!==v&&(n=Math.min(Number(v),n)),void(n!==r?i({target:{value:String(n)}}):i(e))}i(e)}},placeholder:h,style:b,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),min:g,max:v,...f})}},49489,e=>{"use strict";e.s(["default",()=>f]);var t=e.i(43476),a=e.i(71645),l=e.i(18566),r=e.i(18955),i=e.i(95273),n=e.i(45889),s=e.i(48563),o=e.i(68788),u=e.i(72369),d=e.i(95384),c=e.i(50341),h=e.i(74846),g=e.i(84828),v=e.i(23967);function f(){let e=(0,l.useParams)(),f=(0,l.useRouter)(),{user:m}=(0,r.useUser)(),{a3s:y=[],setA3s:p}=(0,i.useA3s)(),b=(null==e?void 0:e.id)||"",[x,w]=(0,a.useState)(null),[A,j]=(0,a.useState)(null),[S,k]=(0,a.useState)(!1),[N,C]=(0,s.default)(),[P,O]=(0,s.default)(),[F,I]=(0,s.default)(),[T,J]=(0,a.useState)(!1),[E,U]=(0,a.useState)(!1),L=a.default.useRef(null),[M,R]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{var e,t,a,l;let r=e=>{if(!e)return!1;try{return!!Array.isArray(e)&&!!m&&e.includes(m)}catch(e){return!1}},i=(y||[]).find(e=>{var t;return(null==e||null==(t=e.header)?void 0:t.id)===b})||null;if(!i)return;let n=null==(e=i.header)?void 0:e.owner,s=Array.isArray(null==(t=i.header)?void 0:t.team)?i.header.team:[];if(!(n===m||s.includes(m)))return void f.push("/home");try{let e=(0,v.ensureLateFlagsForA3)(i);e=(0,v.ensureProgressForA3)(e);let t=JSON.stringify(e)!==JSON.stringify(i);k(n===m),w(e),R(n===m||r(null==(a=e.layout)?void 0:a.canEdit)),t&&(async()=>{try{let t=await fetch("/api/a3s",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text().catch(()=>"");console.warn("Auto-save late flags/progress failed",t.status,e)}}catch(e){console.warn("Auto-save late flags/progress error",e)}})()}catch(e){k(n===m),w(i),R(n===m||r(null==(l=i.layout)?void 0:l.canEdit))}},[y,b,f,m]),(0,a.useEffect)(()=>{var e,t,a,l,r,i,n,s,u,d,c;let h=null==x||null==(e=x.header)?void 0:e.start,g=null==x||null==(t=x.header)?void 0:t.end;if(!h||!g||!(null==x?void 0:x.metrics))return;let v=e=>{let t={daily:0,weekly:1,monthly:2},a={days:0,weeks:1,months:2},l=(e,l)=>{var r,i;return!l||(null!=(r=t[e])?r:0)>=(null!=(i=a[l])?i:0)};return l("daily",e)&&!(0,o.shouldDisableFrequency)(h,g,"daily",100)?"daily":l("weekly",e)&&!(0,o.shouldDisableFrequency)(h,g,"weekly",100)?"weekly":l("monthly",e)&&!(0,o.shouldDisableFrequency)(h,g,"monthly",100)?"monthly":null},f=!1,m="function"==typeof structuredClone?structuredClone(x):JSON.parse(JSON.stringify(x));m.metrics=m.metrics||{};let y=m.metrics.lag||{},p=Array.isArray(y.data)?y.data:[];if(p&&0!==p.length)try{let e=m.metrics.lag.data[0]||{},t=void 0===e.value?null:e.value,a=void 0!==(null==(s=m.metrics.lag)?void 0:s.initial)?m.metrics.lag.initial:null,l=null!==t&&""!==t&&Number.isFinite(Number(t))?Number(t):null,r=null!==a&&""!==a&&Number.isFinite(Number(a))?Number(a):null;l!==r&&(m.metrics.lag.data[0]={...m.metrics.lag.data[0]||{},value:r},f=!0)}catch(e){}else{let e=(null==(l=m.metrics.lag)||null==(a=l.target)?void 0:a.granularity)||null,t=(null==(i=m.metrics.lag)||null==(r=i.display)?void 0:r.freq)||v(e);if(t){let e=(0,o.generateBuckets)(h,g,t),a=void 0!==(null==(n=m.metrics.lag)?void 0:n.initial)?m.metrics.lag.initial:null;m.metrics.lag={...m.metrics.lag||{},data:e.map((e,t)=>({date:e,value:0===t&&null!==a&&""!==a?a:null})),display:{...m.metrics.lag.display||{},freq:t}},f=!0}}m.metrics.leads=m.metrics.leads||[];for(let e=0;e<m.metrics.leads.length;e++){let t=m.metrics.leads[e]||{},a=Array.isArray(t.data)?t.data:[];if(a&&0!==a.length)try{let t=m.metrics.leads[e].data[0]||{},a=void 0===t.value?null:t.value,l=void 0!==(null==(c=m.metrics.leads[e])?void 0:c.initial)?m.metrics.leads[e].initial:null,r=null!==a&&""!==a&&Number.isFinite(Number(a))?Number(a):null,i=null!==l&&""!==l&&Number.isFinite(Number(l))?Number(l):null;r!==i&&(m.metrics.leads[e].data[0]={...m.metrics.leads[e].data[0]||{},value:i},f=!0)}catch(e){}else{let a=(null==t||null==(u=t.target)?void 0:u.granularity)||null,l=(null==(d=t.display)?void 0:d.freq)||v(a);if(l){let a=(0,o.generateBuckets)(h,g,l),r=void 0!==(null==t?void 0:t.initial)?t.initial:null;m.metrics.leads[e]={...m.metrics.leads[e]||{},data:a.map((e,t)=>({date:e,value:0===t&&null!==r&&""!==r?Number(r):null})),display:{...m.metrics.leads[e].display||{},freq:l}},f=!0}}}f&&w(m)},[x,w]),!m)return null;if(!x)return(0,t.jsx)("div",{style:{padding:24,textAlign:"center"},children:"Loading A3 for editâ€¦"});let q=async()=>{try{U(!0);let e="function"==typeof structuredClone?structuredClone(x):JSON.parse(JSON.stringify(x));e.draft=x.draft,e.published=x.published,e.header=e.header||{},e.header.lastUpdated=new Date().toISOString();let t=await fetch("/api/a3s",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();console.error("Failed to update A3",t.status,e);return}let a=await t.json(),l=a||e;w(l);try{if("function"==typeof p){let e=await fetch("/api/a3s");if(e.ok){let t=await e.json();p(Array.isArray(t)?t:[])}else p(e=>{let t=Array.isArray(e)?e.slice():[],a=t.findIndex(e=>{var t,a;return(null==e||null==(t=e.header)?void 0:t.id)===(null==l||null==(a=l.header)?void 0:a.id)});return a>=0?t[a]=l:t.push(l),t})}}catch(e){console.warn("Could not refresh global A3 list",e)}console.log("A3 updated",a),f.push("/home")}catch(e){console.error("Error updating A3",e),f.push("/home")}finally{U(!1)}},D=async()=>{q();try{var e,t,a;U(!0);let l=null==x||null==(a=x.header)||null==(t=a.id)||null==(e=t.split("-"))?void 0:e[1];if(!l)return void console.error("Cannot determine series id for versioning");let r=await fetch("/api/a3s/".concat(l,"/versions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author:m||null,message:"Version from ".concat(m||"unknown")})});if(!r.ok){let e=await r.text();console.error("Failed to create version",r.status,e);return}let i=await r.json(),n=null==i?void 0:i.version;w(e=>{if(!e)return e;let t="function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e));if(t.header&&"string"==typeof t.header.id){let e=t.header.id.split("-");e[2]=n,t.header.id=e.join("-"),t.header.lastUpdated=new Date().toISOString(),t.published=!0,t.draft=!1}return t});try{if("function"==typeof p){let e=await fetch("/api/a3s");if(e.ok){let t=await e.json();p(Array.isArray(t)?t:[])}}}catch(e){console.warn("Could not refresh global A3 list after versioning",e)}f.push("/home")}catch(e){console.error("Error creating version",e)}finally{U(!1)}},B={height:"5vh",alignItems:"center",justifyContent:"center",display:"flex",border:"none",borderRadius:6,cursor:"pointer",color:"white",fontWeight:"bold"};return(0,t.jsxs)("div",{style:{width:"100vw",minHeight:"100vh",padding:"1em",boxSizing:"border-box",justifySelf:"center",alignItems:"center",display:"flex",flexDirection:"column",background:"#f0f0f0",gap:"6px"},children:[(0,t.jsx)(n.default,{a3:x,setA3:w,activeArea:A,setActiveArea:j,boundsPreview:I,refPlan2:N,boundsPlan2:C,refPlan4:P,boundsPlan4:O}),S&&(0,t.jsx)(h.default,{a3:x,setA3:w,activeArea:{0:"header",1:"probDef",2:"currentState",3:"objectives",4:"actionPlan",5:null,6:"metrics"}[A],setShowLayout:J,width:I.width,color:A?[["var(--blue-highlight)","var(--blue-highlight)",,"var(--blue)"],["var(--accent-highlight)","var(--accent-highlight)","var(--accent)"],["white","var(--accent-highlight)","var(--accent)"],["var(--accent-highlight)","var(--accent-highlight)","var(--accent)"],["white","var(--accent-highlight)","var(--accent)"],["var(--green-highlight)","var(--green-highlight)","var(--green)"],["var(--orange-highlight)","var(--orange-highlight)","var(--orange)"]][A][2]:void 0}),(0,t.jsx)(c.default,{a3:x,setA3:w,activeArea:A,setActiveArea:j,refPlan2:N,boundsPlan2:C,refPlan4:P,boundsPlan4:O,refPreview:F,boundsPreview:I,showLayout:T,setShowLayout:J,toggleImgSelectorCurrent:()=>{imagePickerTarget.current="currentState",setImagePickerOpen(!0)},toggleImgSelectorActionPlan:()=>{imagePickerTarget.current="actionPlan",setImagePickerOpen(!0)},editable:!0,owner:S}),(0,t.jsxs)("div",{style:{width:I.width,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[(0,t.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8},children:M&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{ref:L,onClick:()=>J(e=>!e),"aria-expanded":T,"aria-label":"Layout settings",style:{...B,aspectRatio:"1/1",backgroundColor:"var(--main-highlight)"},children:(0,t.jsx)(g.FaGear,{})}),(0,t.jsx)(u.default,{a3:x,setA3:w,open:T,onClose:()=>J(!1),anchorRef:L})]})}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[x.draft&&S&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(d.default,{a3:x,setA3:w,style:{...B,padding:"6px",backgroundColor:"var(--main)"}})}),x.published&&S&&(0,t.jsx)("button",{onClick:D,disabled:E||!S,style:{...B,backgroundColor:"var(--main)",padding:"6px"},children:E?"Creating version...":"New Version"}),(0,t.jsx)("button",{onClick:q,disabled:E,style:{...B,backgroundColor:"var(--main-highlight)",padding:"6px"},children:E?"Updating...":"Update"})]})]})]})}},28471,e=>{e.v(t=>Promise.all(["static/chunks/9fd74ab7f5b98773.js"].map(t=>e.l(t))).then(()=>t(99938)))},70653,e=>{e.v(t=>Promise.all(["static/chunks/3b0e68bb28d244be.js"].map(t=>e.l(t))).then(()=>t(24154)))}]);